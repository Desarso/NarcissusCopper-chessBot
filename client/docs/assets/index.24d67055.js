(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();const O={};function tt(r){O.context=r}const nt=(r,t)=>r===t,it=Symbol("solid-track"),ce={equals:nt};let Le=Oe;const G=1,he=2,Ke={owned:null,cleanups:null,context:null,owner:null};var M=null;let _=null,C=null,A=null,j=null,Be=0;function le(r,t){const e=C,i=M,s=r.length===0,n=s?Ke:{owned:null,cleanups:null,context:null,owner:t||i},c=s?r:()=>r(()=>X(()=>pe(n)));M=n,C=null;try{return re(c,!0)}finally{C=e,M=i}}function k(r,t){t=t?Object.assign({},ce,t):ce;const e={value:r,observers:null,observerSlots:null,comparator:t.equals||void 0},i=s=>(typeof s=="function"&&(s=s(e.value)),De(e,s));return[Qe.bind(e),i]}function V(r,t,e){const i=Ce(r,t,!1,G);oe(i)}function st(r,t,e){Le=at;const i=Ce(r,t,!1,G);i.user=!0,j?j.push(i):oe(i)}function H(r,t,e){e=e?Object.assign({},ce,e):ce;const i=Ce(r,t,!0,0);return i.observers=null,i.observerSlots=null,i.comparator=e.equals||void 0,oe(i),Qe.bind(i)}function X(r){const t=C;C=null;try{return r()}finally{C=t}}function se(r){st(()=>X(r))}function ot(r){return M===null||(M.cleanups===null?M.cleanups=[r]:M.cleanups.push(r)),r}function rt(r,t){const e=Symbol("context");return{id:e,Provider:dt(e),defaultValue:r}}function lt(r){let t;return(t=He(M,r.id))!==void 0?t:r.defaultValue}function ct(r){const t=H(r),e=H(()=>Ie(t()));return e.toArray=()=>{const i=e();return Array.isArray(i)?i:i!=null?[i]:[]},e}function Qe(){const r=_;if(this.sources&&(this.state||r))if(this.state===G||r)oe(this);else{const t=A;A=null,re(()=>ae(this),!1),A=t}if(C){const t=this.observers?this.observers.length:0;C.sources?(C.sources.push(this),C.sourceSlots.push(t)):(C.sources=[this],C.sourceSlots=[t]),this.observers?(this.observers.push(C),this.observerSlots.push(C.sources.length-1)):(this.observers=[C],this.observerSlots=[C.sources.length-1])}return this.value}function De(r,t,e){let i=r.value;return(!r.comparator||!r.comparator(i,t))&&(r.value=t,r.observers&&r.observers.length&&re(()=>{for(let s=0;s<r.observers.length;s+=1){const n=r.observers[s],c=_&&_.running;c&&_.disposed.has(n),(c&&!n.tState||!c&&!n.state)&&(n.pure?A.push(n):j.push(n),n.observers&&Ue(n)),c||(n.state=G)}if(A.length>1e6)throw A=[],new Error},!1)),t}function oe(r){if(!r.fn)return;pe(r);const t=M,e=C,i=Be;C=M=r,ht(r,r.value,i),C=e,M=t}function ht(r,t,e){let i;try{i=r.fn(t)}catch(s){r.pure&&(r.state=G,r.owned&&r.owned.forEach(pe),r.owned=null),je(s)}(!r.updatedAt||r.updatedAt<=e)&&(r.updatedAt!=null&&"observers"in r?De(r,i):r.value=i,r.updatedAt=e)}function Ce(r,t,e,i=G,s){const n={fn:r,state:i,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:M,context:null,pure:e};return M===null||M!==Ke&&(M.owned?M.owned.push(n):M.owned=[n]),n}function ue(r){const t=_;if(r.state===0||t)return;if(r.state===he||t)return ae(r);if(r.suspense&&X(r.suspense.inFallback))return r.suspense.effects.push(r);const e=[r];for(;(r=r.owner)&&(!r.updatedAt||r.updatedAt<Be);)(r.state||t)&&e.push(r);for(let i=e.length-1;i>=0;i--)if(r=e[i],r.state===G||t)oe(r);else if(r.state===he||t){const s=A;A=null,re(()=>ae(r,e[0]),!1),A=s}}function re(r,t){if(A)return r();let e=!1;t||(A=[]),j?e=!0:j=[],Be++;try{const i=r();return ut(e),i}catch(i){A||(j=null),je(i)}}function ut(r){if(A&&(Oe(A),A=null),r)return;const t=j;j=null,t.length&&re(()=>Le(t),!1)}function Oe(r){for(let t=0;t<r.length;t++)ue(r[t])}function at(r){let t,e=0;for(t=0;t<r.length;t++){const i=r[t];i.user?r[e++]=i:ue(i)}for(O.context&&tt(),t=0;t<e;t++)ue(r[t])}function ae(r,t){const e=_;r.state=0;for(let i=0;i<r.sources.length;i+=1){const s=r.sources[i];s.sources&&(s.state===G||e?s!==t&&ue(s):(s.state===he||e)&&ae(s,t))}}function Ue(r){const t=_;for(let e=0;e<r.observers.length;e+=1){const i=r.observers[e];(!i.state||t)&&(i.state=he,i.pure?A.push(i):j.push(i),i.observers&&Ue(i))}}function pe(r){let t;if(r.sources)for(;r.sources.length;){const e=r.sources.pop(),i=r.sourceSlots.pop(),s=e.observers;if(s&&s.length){const n=s.pop(),c=e.observerSlots.pop();i<s.length&&(n.sourceSlots[c]=i,s[i]=n,e.observerSlots[i]=c)}}if(r.owned){for(t=0;t<r.owned.length;t++)pe(r.owned[t]);r.owned=null}if(r.cleanups){for(t=0;t<r.cleanups.length;t++)r.cleanups[t]();r.cleanups=null}r.state=0,r.context=null}function ft(r){return r instanceof Error||typeof r=="string"?r:new Error("Unknown error")}function je(r){throw r=ft(r),r}function He(r,t){return r?r.context&&r.context[t]!==void 0?r.context[t]:He(r.owner,t):void 0}function Ie(r){if(typeof r=="function"&&!r.length)return Ie(r());if(Array.isArray(r)){const t=[];for(let e=0;e<r.length;e++){const i=Ie(r[e]);Array.isArray(i)?t.push.apply(t,i):t.push(i)}return t}return r}function dt(r,t){return function(i){let s;return V(()=>s=X(()=>(M.context={[r]:i.value},ct(()=>i.children))),void 0),s}}const pt=Symbol("fallback");function Ae(r){for(let t=0;t<r.length;t++)r[t]()}function gt(r,t,e={}){let i=[],s=[],n=[],c=0,o=t.length>1?[]:null;return ot(()=>Ae(n)),()=>{let l=r()||[],a,u;return l[it],X(()=>{let P=l.length,g,R,b,$,F,N,S,T,q;if(P===0)c!==0&&(Ae(n),n=[],i=[],s=[],c=0,o&&(o=[])),e.fallback&&(i=[pt],s[0]=le(Q=>(n[0]=Q,e.fallback())),c=1);else if(c===0){for(s=new Array(P),u=0;u<P;u++)i[u]=l[u],s[u]=le(d);c=P}else{for(b=new Array(P),$=new Array(P),o&&(F=new Array(P)),N=0,S=Math.min(c,P);N<S&&i[N]===l[N];N++);for(S=c-1,T=P-1;S>=N&&T>=N&&i[S]===l[T];S--,T--)b[T]=s[S],$[T]=n[S],o&&(F[T]=o[S]);for(g=new Map,R=new Array(T+1),u=T;u>=N;u--)q=l[u],a=g.get(q),R[u]=a===void 0?-1:a,g.set(q,u);for(a=N;a<=S;a++)q=i[a],u=g.get(q),u!==void 0&&u!==-1?(b[u]=s[a],$[u]=n[a],o&&(F[u]=o[a]),u=R[u],g.set(q,u)):n[a]();for(u=N;u<P;u++)u in b?(s[u]=b[u],n[u]=$[u],o&&(o[u]=F[u],o[u](u))):s[u]=le(d);s=s.slice(0,c=P),i=l.slice(0)}return s});function d(P){if(n[u]=P,o){const[g,R]=k(u);return o[u]=R,t(l[u],g)}return t(l[u])}}}function E(r,t){return X(()=>r(t||{}))}function Ge(r){const t="fallback"in r&&{fallback:()=>r.fallback};return H(gt(()=>r.each,r.children,t||void 0))}function ge(r){let t=!1;const e=r.keyed,i=H(()=>r.when,void 0,{equals:(s,n)=>t?s===n:!s==!n});return H(()=>{const s=i();if(s){const n=r.children,c=typeof n=="function"&&n.length>0;return t=e||c,c?X(()=>n(s)):n}return r.fallback},void 0,void 0)}function Pt(r,t,e){let i=e.length,s=t.length,n=i,c=0,o=0,l=t[s-1].nextSibling,a=null;for(;c<s||o<n;){if(t[c]===e[o]){c++,o++;continue}for(;t[s-1]===e[n-1];)s--,n--;if(s===c){const u=n<i?o?e[o-1].nextSibling:e[n-o]:l;for(;o<n;)r.insertBefore(e[o++],u)}else if(n===o)for(;c<s;)(!a||!a.has(t[c]))&&t[c].remove(),c++;else if(t[c]===e[n-1]&&e[o]===t[s-1]){const u=t[--s].nextSibling;r.insertBefore(e[o++],t[c++].nextSibling),r.insertBefore(e[--n],u),t[s]=e[n]}else{if(!a){a=new Map;let d=o;for(;d<n;)a.set(e[d],d++)}const u=a.get(t[c]);if(u!=null)if(o<u&&u<n){let d=c,P=1,g;for(;++d<s&&d<n&&!((g=a.get(t[d]))==null||g!==u+P);)P++;if(P>u-o){const R=t[c];for(;o<u;)r.insertBefore(e[o++],R)}else r.replaceChild(e[o++],t[c++])}else c++;else t[c++].remove()}}}const Re="_$DX_DELEGATE";function wt(r,t,e,i={}){let s;return le(n=>{s=n,t===document?r():Pe(t,r(),t.firstChild?null:void 0,e)},i.owner),()=>{s(),t.textContent=""}}function J(r,t,e){const i=document.createElement("template");i.innerHTML=r;let s=i.content.firstChild;return e&&(s=s.firstChild),s}function Se(r,t=window.document){const e=t[Re]||(t[Re]=new Set);for(let i=0,s=r.length;i<s;i++){const n=r[i];e.has(n)||(e.add(n),t.addEventListener(n,xt))}}function be(r,t,e){e==null?r.removeAttribute(t):r.setAttribute(t,e)}function fe(r,t){t==null?r.removeAttribute("class"):r.className=t}function vt(r,t,e){if(!t)return e?be(r,"style"):t;const i=r.style;if(typeof t=="string")return i.cssText=t;typeof e=="string"&&(i.cssText=e=void 0),e||(e={}),t||(t={});let s,n;for(n in e)t[n]==null&&i.removeProperty(n),delete e[n];for(n in t)s=t[n],s!==e[n]&&(i.setProperty(n,s),e[n]=s);return e}function $e(r,t,e){return X(()=>r(t,e))}function Pe(r,t,e,i){if(e!==void 0&&!i&&(i=[]),typeof t!="function")return de(r,t,i,e);V(s=>de(r,t(),s,e),i)}function xt(r){const t=`$$${r.type}`;let e=r.composedPath&&r.composedPath()[0]||r.target;for(r.target!==e&&Object.defineProperty(r,"target",{configurable:!0,value:e}),Object.defineProperty(r,"currentTarget",{configurable:!0,get(){return e||document}}),O.registry&&!O.done&&(O.done=!0,document.querySelectorAll("[id^=pl-]").forEach(i=>{for(;i&&i.nodeType!==8&&i.nodeValue!=="pl-"+r;){let s=i.nextSibling;i.remove(),i=s}i&&i.remove()}));e;){const i=e[t];if(i&&!e.disabled){const s=e[`${t}Data`];if(s!==void 0?i.call(e,s,r):i.call(e,r),r.cancelBubble)return}e=e._$host||e.parentNode||e.host}}function de(r,t,e,i,s){for(O.context&&!e&&(e=[...r.childNodes]);typeof e=="function";)e=e();if(t===e)return e;const n=typeof t,c=i!==void 0;if(r=c&&e[0]&&e[0].parentNode||r,n==="string"||n==="number"){if(O.context)return e;if(n==="number"&&(t=t.toString()),c){let o=e[0];o&&o.nodeType===3?o.data=t:o=document.createTextNode(t),e=z(r,e,i,o)}else e!==""&&typeof e=="string"?e=r.firstChild.data=t:e=r.textContent=t}else if(t==null||n==="boolean"){if(O.context)return e;e=z(r,e,i)}else{if(n==="function")return V(()=>{let o=t();for(;typeof o=="function";)o=o();e=de(r,o,e,i)}),()=>e;if(Array.isArray(t)){const o=[],l=e&&Array.isArray(e);if(Te(o,t,e,s))return V(()=>e=de(r,o,e,i,!0)),()=>e;if(O.context){if(!o.length)return e;for(let a=0;a<o.length;a++)if(o[a].parentNode)return e=o}if(o.length===0){if(e=z(r,e,i),c)return e}else l?e.length===0?Ne(r,o,i):Pt(r,e,o):(e&&z(r),Ne(r,o));e=o}else if(t instanceof Node){if(O.context&&t.parentNode)return e=c?[t]:t;if(Array.isArray(e)){if(c)return e=z(r,e,i,t);z(r,e,null,t)}else e==null||e===""||!r.firstChild?r.appendChild(t):r.replaceChild(t,r.firstChild);e=t}}return e}function Te(r,t,e,i){let s=!1;for(let n=0,c=t.length;n<c;n++){let o=t[n],l=e&&e[n];if(o instanceof Node)r.push(o);else if(!(o==null||o===!0||o===!1))if(Array.isArray(o))s=Te(r,o,l)||s;else if(typeof o=="function")if(i){for(;typeof o=="function";)o=o();s=Te(r,Array.isArray(o)?o:[o],Array.isArray(l)?l:[l])||s}else r.push(o),s=!0;else{const a=String(o);l&&l.nodeType===3&&l.data===a?r.push(l):r.push(document.createTextNode(a))}}return s}function Ne(r,t,e=null){for(let i=0,s=t.length;i<s;i++)r.insertBefore(t[i],e)}function z(r,t,e,i){if(e===void 0)return r.textContent="";const s=i||document.createTextNode("");if(t.length){let n=!1;for(let c=t.length-1;c>=0;c--){const o=t[c];if(s!==o){const l=o.parentNode===r;!n&&!c?l?r.replaceChild(s,o):r.insertBefore(s,e):l&&o.remove()}else n=!0}}else r.insertBefore(s,e);return[s]}const ee="b",te="k",me="n",qe="p",ne="q";class f{x;y;constructor(t,e){this.x=t,this.y=e}}class h{start;end;boardStartIndex;boardEndIndex;constructor(t,e,i,s){if(i&&(this.start=i),s&&(this.end=s),i&&s){this.boardStartIndex=this.convertToBoardIndex(i),this.boardEndIndex=this.convertToBoardIndex(s);return}t&&e?(this.boardStartIndex=t.x+t.y*8,this.boardEndIndex=e.x+e.y*8,this.start=this.convertToBoardPosition(this.boardStartIndex),this.end=this.convertToBoardPosition(this.boardEndIndex)):(this.start="a8",this.end="a8",this.boardStartIndex=0,this.boardEndIndex=0)}toString(){return this.start+"-"+this.end}convertToBoardIndex(t){if(t.length!=2)throw new Error("Invalid position");let e=t[0],i=t[1],s=e.charCodeAt(0)-97,n=8-parseInt(i);return s+n*8}convertToBoardPosition(t){if(t<0||t>63)throw new Error("Invalid index: "+t);let e=t%8,i=Math.floor(t/8),s=String.fromCharCode(e+97),n=8-i;return s+n}testConverToBoardIndex(){let t=[];t.push(this.convertToBoardIndex("a8")==0),t.push(this.convertToBoardIndex("b8")==1),t.push(this.convertToBoardIndex("c8")==2),t.push(this.convertToBoardIndex("d8")==3),t.push(this.convertToBoardIndex("e8")==4),t.push(this.convertToBoardIndex("f8")==5),t.push(this.convertToBoardIndex("g8")==6),t.push(this.convertToBoardIndex("h8")==7),t.push(this.convertToBoardIndex("a7")==8),t.push(this.convertToBoardIndex("b7")==9),t.push(this.convertToBoardIndex("c7")==10),t.push(this.convertToBoardIndex("d7")==11),t.push(this.convertToBoardIndex("e7")==12),t.push(this.convertToBoardIndex("f7")==13),t.push(this.convertToBoardIndex("g7")==14),t.push(this.convertToBoardIndex("h7")==15),t.push(this.convertToBoardIndex("a6")==16);for(let e=0;e<t.length;e++)if(!t[e])throw new Error("Convert to board Index failed failed")}runAllTests(){this.testConverToBoardIndex(),console.log("All tests ran for move class")}}class ie{position;pos;boardIndex;constructor(t,e){t?(this.position=t,this.boardIndex=this.convertToBoardIndex(t),this.pos=new f(this.convertToBoardIndex(t)%8,Math.floor(this.convertToBoardIndex(t)/8))):e?(this.boardIndex=e,this.position=this.convertToBoardPosition(e),this.pos=new f(e%8,Math.floor(e/8))):(this.position="a8",this.boardIndex=0,this.pos=new f(0,0))}moveTo(t){this.position=t,this.boardIndex=this.convertToBoardIndex(t),this.pos=new f(this.boardIndex%8,Math.floor(this.boardIndex/8))}getPosition(){return this.position}getIndex(){return this.boardIndex}convertToBoardIndex(t){if(t.length!=2)throw new Error("Invalid position");let e=t[0],i=t[1],s=e.charCodeAt(0)-97,n=8-parseInt(i);return s+n*8}testConvertToBoardIndex(){let t=[];t.push(this.convertToBoardIndex("a8")==0),t.push(this.convertToBoardIndex("b8")==1),t.push(this.convertToBoardIndex("c8")==2),t.push(this.convertToBoardIndex("d8")==3),t.push(this.convertToBoardIndex("e8")==4),t.push(this.convertToBoardIndex("f8")==5),t.push(this.convertToBoardIndex("g8")==6),t.push(this.convertToBoardIndex("h8")==7),t.push(this.convertToBoardIndex("a7")==8),t.push(this.convertToBoardIndex("b7")==9),t.push(this.convertToBoardIndex("c7")==10),t.push(this.convertToBoardIndex("d7")==11),t.push(this.convertToBoardIndex("e7")==12),t.push(this.convertToBoardIndex("f7")==13),t.push(this.convertToBoardIndex("g7")==14),t.push(this.convertToBoardIndex("h7")==15),t.push(this.convertToBoardIndex("a6")==16);for(let e=0;e<t.length;e++)if(!t[e])throw new Error("Convert to board Index failed failed")}convertToBoardPosition(t){let e=t%8,i=Math.floor(t/8),s=String.fromCharCode(e+97),n=8-i;return s+n}testConvertToPosition(){let t=[];t.push(this.convertToBoardPosition(0)=="a8"),t.push(this.convertToBoardPosition(0)=="a8"),t.push(this.convertToBoardPosition(0)=="a8"),t.push(this.convertToBoardPosition(1)=="b8"),t.push(this.convertToBoardPosition(2)=="c8"),t.push(this.convertToBoardPosition(3)=="d8"),t.push(this.convertToBoardPosition(4)=="e8"),t.push(this.convertToBoardPosition(5)=="f8"),t.push(this.convertToBoardPosition(6)=="g8"),t.push(this.convertToBoardPosition(7)=="h8"),t.push(this.convertToBoardPosition(8)=="a7"),t.push(this.convertToBoardPosition(9)=="b7"),t.push(this.convertToBoardPosition(10)=="c7"),t.push(this.convertToBoardPosition(11)=="d7"),t.push(this.convertToBoardPosition(12)=="e7"),t.push(this.convertToBoardPosition(13)=="f7"),t.push(this.convertToBoardPosition(14)=="g7"),t.push(this.convertToBoardPosition(15)=="h7"),t.push(this.convertToBoardPosition(16)=="a6");for(let e=0;e<t.length;e++)if(!t[e])throw new Error("Convert to position failed")}runAllTests(){this.testConvertToBoardIndex(),this.testConvertToPosition(),console.log("All tests ran for position class")}}class y{position;color;type;constructor(t,e,i){this.position=new ie(t),this.color=e,this.type=i}move(t){this.position.moveTo(t)}getPosition(){return this.position.getPosition()}getIndex(){return this.position.getIndex()}getPos(){return this.position}convertToBoardIndex(t){if(t.length!=2)throw new Error("Invalid position");let e=t[0],i=t[1],s=e.charCodeAt(0)-97,n=8-parseInt(i);return s+n*8}testConverToBoardIndex(){let t=[];t.push(this.convertToBoardIndex("a8")==0),t.push(this.convertToBoardIndex("b8")==1),t.push(this.convertToBoardIndex("c8")==2),t.push(this.convertToBoardIndex("d8")==3),t.push(this.convertToBoardIndex("e8")==4),t.push(this.convertToBoardIndex("f8")==5),t.push(this.convertToBoardIndex("g8")==6),t.push(this.convertToBoardIndex("h8")==7),t.push(this.convertToBoardIndex("a7")==8),t.push(this.convertToBoardIndex("b7")==9),t.push(this.convertToBoardIndex("c7")==10),t.push(this.convertToBoardIndex("d7")==11),t.push(this.convertToBoardIndex("e7")==12),t.push(this.convertToBoardIndex("f7")==13),t.push(this.convertToBoardIndex("g7")==14),t.push(this.convertToBoardIndex("h7")==15),t.push(this.convertToBoardIndex("a6")==16);for(let e=0;e<t.length;e++)if(!t[e])throw new Error("Convert to board Index failed failed")}runAllTests(){this.testConverToBoardIndex(),console.log("All tests ran for piece class")}}class v{Pieces;currentTurnColor="white";fen="";board=[];halfMoveClock=0;fullMoveNumber=1;castlingRights="KQkq";enPassantTargetSquare="-";legalMoves=[];inCheck=!1;checkMate=!1;capturedPieces=[];constructor(t,e){t||(t=["r","n","b","q","k","b","n","r","p","p","p","p","p","p","p","p"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","P","P","P","P","P","P","P","P","R","N","B","Q","K","B","N","R"]);const i=/^([rnbqkpRNBQKP1-8]+\/){7}([rnbqkpRNBQKP1-8]+)\s[bw]\s(-|K?Q?k?q?)\s(-|[a-h][36])\s(0|[1-9][0-9]*)\s([1-9][0-9]*)/;if(e!=null&&e.match(i)){let s=e.split(" ");t=this.fenToBoard(e),this.castlingRights=s[2],this.enPassantTargetSquare=s[3],s[1]==="w"?this.currentTurnColor="white":this.currentTurnColor="black",this.halfMoveClock=parseInt(s[4]),this.fullMoveNumber=parseInt(s[5])}else if(e!=null&&!e.match(i))throw new Error("Invalid fen: "+e);this.Pieces=[];for(let s=0;s<t.length;s++){let n=t[s];if(n!=" "){let c=n==n.toUpperCase()?"white":"black",o=n.toLowerCase(),l=this.convertToPosition(s);this.Pieces.push(new y(l,c,o))}}this.board=t,e!=null?this.fen=e:this.fen=this.boardToFen()}convertToPosition(t){let e=String.fromCharCode(97+t%8),i=8-Math.floor(t/8);return e+i}displayBoard(){let t="";for(let e=0;e<8;e++){for(let i=0;i<8;i++)t+=this.Piece(new f(i,e))===" "?" - ":" "+this.Piece(new f(i,e)).type+" ";t!=null&&console.log(`${8-e}| `+t),t=""}console.log("    _  _  _  _  _  _  _  _"),console.log("    A  B  C  D  E  F  G  H")}fenToBoard(t){let e=[],n=t.split(" ")[0].split("/");for(let c=0;c<n.length;c++){let l=n[c].split("");for(let a=0;a<l.length;a++){let u=l[a];if(u.match(/[1-8]/))for(let d=0;d<parseInt(u);d++)e.push(" ");else e.push(u)}}return e.length===63&&e.push(" "),e}boardToFen(){let t="",e=0;for(let i=0;i<64;i++){let s=this.getPieceAtBoardIndex(i);s===""?(e++,(e===8||i%8===7)&&(t+=e,i!=63&&(t+="/"),e=0)):(e!==0&&(t+=e,e=0),t+=s.color==="white"?s.type.toUpperCase():s.type.toLowerCase(),s.getIndex()%8===7&&i!==63&&(t+="/",e=0))}return t+=" "+this.currentTurnColor[0]+" ",t+=this.castlingRights+" ",t+=this.enPassantTargetSquare+" ",t+=this.halfMoveClock+" ",t+=this.fullMoveNumber,t}getPieceAtBoardIndex(t){for(let e=0;e<this.Pieces.length;e++)if(this.Pieces[e].getIndex()===t)return this.Pieces[e];return""}movePiece(t,e){let i=new h(void 0,void 0,t,e);i.boardEndIndex;let s=this.getPieceIndex(t),n=this.Pieces[s];if(n?.type===void 0)throw this.displayBoard(),console.log(this.Pieces),console.log(this.fen),console.log(t),new Error("Invalid move");if(n.type!="p"?this.halfMoveClock++:this.halfMoveClock=0,this.enPassantTargetSquare!="-"&&n.type==="p"){let c=new ie(t),o=new ie(e);if(n.color==="white"&&c.pos.y===3&&o.position===e){let l=o.boardIndex+8,a=this.getPieceAtBoardIndex(l);this.board[l]=" ",this.Pieces.splice(this.Pieces.indexOf(a),1)}if(n.color==="black"&&c.pos.y===4&&o.position===e){let l=o.boardIndex-8,a=this.getPieceAtBoardIndex(l);this.board[l]=" ",this.Pieces.splice(this.Pieces.indexOf(a),1)}}if(n.type=="p"&&Math.abs(n.getIndex()-i.boardEndIndex)==16){let c="-";n.color==="white"?c=this.convertToPosition(i.boardEndIndex+8):c=this.convertToPosition(i.boardEndIndex-8),this.enPassantTargetSquare=c}else this.enPassantTargetSquare="-";if(n.type==="k"){this.castlingRights.length===2?this.castlingRights="-":n.color==="white"?this.castlingRights=this.castlingRights.replace("KQ",""):this.castlingRights=this.castlingRights.replace("kq","");let c=new ie(t),o=new ie(e);if(c.pos.x-o.pos.x===2){this.convertToPosition(c.boardIndex-4);let l=this.convertToPosition(c.boardIndex-1);this.getPieceAtBoardIndex(c.boardIndex-4).move(l)}if(c.pos.x-o.pos.x===-2){this.convertToPosition(c.boardIndex+3);let l=this.convertToPosition(c.boardIndex+1);this.getPieceAtBoardIndex(c.boardIndex+3).move(l)}}if(this.currentTurnColor==="black"&&this.fullMoveNumber++,n.type==="r"&&(n.color==="white"?n.getIndex()===0?this.castlingRights=this.castlingRights.replace("Q",""):n.getIndex()===7&&(this.castlingRights=this.castlingRights.replace("K","")):n.getIndex()===56?this.castlingRights=this.castlingRights.replace("q",""):n.getIndex()===63&&(this.castlingRights=this.castlingRights.replace("k",""))),this.getPieceIndex(e)!==-1){let c=this.getPieceIndex(e),o=this.Pieces[c];this.capturedPieces.push(o),this.Pieces.splice(c,1),this.halfMoveClock=0}n.move(e),this.currentTurnColor=this.currentTurnColor==="white"?"black":"white",this.fen=this.boardToFen(),this.board=this.fenToBoard(this.fen),this.inCheck=this.isInCheck(this)}getPieceIndex(t){let e=-1;for(let i=0;i<this.Pieces.length;i++)if(this.Pieces[i].getPosition()==t){e=i;break}return e}getPieceAtPosition(t){let e="";for(let i=0;i<this.Pieces.length;i++){let s=this.Pieces[i];if(s.getPosition()==t)return s}return e}testConvertToPosition(){let t=[];t.push(this.convertToPosition(0)=="a8"),t.push(this.convertToPosition(1)=="b8"),t.push(this.convertToPosition(2)=="c8"),t.push(this.convertToPosition(3)=="d8"),t.push(this.convertToPosition(4)=="e8"),t.push(this.convertToPosition(5)=="f8"),t.push(this.convertToPosition(6)=="g8"),t.push(this.convertToPosition(7)=="h8"),t.push(this.convertToPosition(8)=="a7"),t.push(this.convertToPosition(9)=="b7"),t.push(this.convertToPosition(10)=="c7"),t.push(this.convertToPosition(11)=="d7"),t.push(this.convertToPosition(12)=="e7"),t.push(this.convertToPosition(13)=="f7"),t.push(this.convertToPosition(14)=="g7"),t.push(this.convertToPosition(15)=="h7"),t.push(this.convertToPosition(16)=="a6");for(let e=0;e<t.length;e++)if(!t[e])throw new Error("Convert to position failed")}testFenToBoard(){let t=[];t.push(this.fenToBoard("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1")),t.push(this.fenToBoard("rnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR b KQkq e3 0 1"));for(let i=0;i<t.length;i++)if(!t[i])throw new Error("Fen to board failed");e(t[0],["r","n","b","q","k","b","n","r","p","p","p","p","p","p","p","p"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","P","P","P","P","P","P","P","P","R","N","B","Q","K","B","N","R"]),e(t[1],["r","n","b","q","k","b","n","r","p","p","p","p","p","p","p","p"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","P"," "," "," "," "," "," "," "," "," "," "," ","P","P","P","P"," ","P","P","P","R","N","B","Q","K","B","N","R"]);function e(i,s){if(i===s)return!0;if(i==null||s==null)throw console.log(i,s),new Error("Fen to board failed");if(i.length!==s.length)throw console.log(i,s),new Error("Fen to board failed");for(var n=0;n<i.length;++n)if(i[n]!==s[n])throw console.log(i,s),new Error("Fen to board failed");return!0}}testBoardToFen(){let t=[],e=new v;t.push(e.boardToFen()=="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"),e.movePiece("e2","e4"),t.push(e.boardToFen()=="rnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR b KQkq e3 0 1");for(let i=0;i<t.length;i++)if(!t[i])throw new Error("Board to fen failed, test "+(i+1)+" failed"+e.boardToFen())}testConstructors(){let t=new v,e=[];e.push(t.Pieces[0]?.getPosition()=="a8"),e.push(t.Pieces[0].color=="black"),e.push(t.Pieces[0].type=="r"),e.push(t.Pieces[1]?.getPosition()=="b8"),e.push(t.Pieces[1].color=="black"),e.push(t.Pieces[1].type=="n"),e.push(t.Pieces[2]?.getPosition()=="c8"),e.push(t.Pieces[2].color=="black"),e.push(t.Pieces[2].type=="b"),e.push(t.Pieces[3]?.getPosition()=="d8");for(let n=0;n<e.length;n++)if(!e[n])throw new Error("Board constructor 1 failed "+n);let i=new v([],"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1");e=[],e.push(i.Pieces[0]?.getPosition()=="a8"),e.push(i.Pieces[0].color=="black"),e.push(i.Pieces[0].type=="r"),e.push(i.Pieces[1]?.getPosition()=="b8"),e.push(i.Pieces[1].color=="black"),e.push(i.Pieces[1].type=="n"),e.push(i.Pieces[2]?.getPosition()=="c8"),e.push(i.Pieces[2].color=="black"),e.push(i.Pieces[2].type=="b"),e.push(i.Pieces[3]?.getPosition()=="d8");for(let n=0;n<e.length;n++)if(!e[n])throw new Error("Board constructor 2 failed"+n);let s=new v([],"rnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR b KQkq e3 0 1");e=[],e.push(s.Pieces[0]?.getPosition()=="a8"),e.push(s.Pieces[0].color=="black"),e.push(s.Pieces[0].type=="r"),e.push(s.currentTurnColor=="black");for(let n=0;n<e.length;n++)if(!e[n])throw new Error("Board constructor 3 failed"+n)}findPseudoLegalMoves(t){let e=[];for(let i=0;i<t.Pieces.length;i++){let s=t.Pieces[i];if(t.currentTurnColor===s.color)switch(s.type){case"p":e.push(...this.findPawnMoves(s,t));break;case"r":e.push(...this.findRookMoves(s,t));break;case"n":e.push(...this.findKnightMoves(s,t));break;case"b":e.push(...this.findBishopMoves(s,t));break;case"q":e.push(...this.findQueenMoves(s,t));break;case"k":e.push(...this.findKingMoves(s,t));break}}return e}testFindPseudoLegalMoves(){let t=new v,e=this.findPseudoLegalMoves(t),i=[];i.push(e.length==20);for(let s=0;s<i.length;s++)if(!i[s])throw new Error("Find legal moves failed, test "+(s+1)+" failed");t=new v([],"rnbqkbnr/1ppp1ppp/8/p3pP2/4P3/8/PPPP2PP/RNBQKBNR w KQkq e6 0 4"),e=this.findPseudoLegalMoves(t),i=[],i.push(e.length==30);for(let s=0;s<i.length;s++)if(!i[s])throw new Error("Find legal moves failed, test "+(s+1)+" failed")}findLegalMoves(t){let e=t.findPseudoLegalMoves(t),i=[];for(let s=0;s<e.length;s++){let n=new v([],t.boardToFen());n.movePiece(e[s].start,e[s].end),n.currentTurnColor=n.currentTurnColor==="white"?"black":"white",this.isInCheck(n)||i.push(e[s])}return i}testFindLegalMoves(){let t=new v,e=this.findLegalMoves(t),i=[];i.push(e.length==20),t=new v([],"rnb1k1nr/pppp1ppp/8/2b1p3/P3q3/8/1PPP1PPP/RNBQKB1R w KQkq - 0 6"),e=this.findLegalMoves(t),i.push(e.length==2),t=new v([],"rnbqkbnr/1ppp1ppp/8/p3Q3/4P3/8/PPPP1PPP/RNB1KBNR b KQkq - 0 3"),e=this.findLegalMoves(t),i.push(e.length==3),t=new v([],"rnbqkbnr/p1p1pppp/1p6/3pP3/8/8/PPPP1PPP/RNBQKBNR w KQkq d6 0 3"),e=this.findLegalMoves(t),i.push(e.length==31);for(let s=0;s<i.length;s++)if(!i[s])throw new Error("Find legal moves failed, test "+(s+1)+" failed")}isInCheck(t){let e=new v([],t.boardToFen()),i=!0;for(let c=0;c<e.board.length;c++)e.board[c]!="-"&&(i=!1);i&&(console.log("empty board"),console.log(t.boardToFen())),e.currentTurnColor=e.currentTurnColor=="white"?"black":"white";let s=t.findPseudoLegalMoves(e),n;for(let c=0;c<t.Pieces.length;c++)t.Pieces[c].type=="k"&&t.Pieces[c].color==t.currentTurnColor&&(n=t.Pieces[c].getIndex());s.length==0&&(console.log("main board"),t.displayBoard(),console.log(t.fen),console.log("thingy"),e.displayBoard(),console.log(e.fen));for(let c=0;c<s.length;c++)if(s[c].boardEndIndex==n)return!0;return!1}testIsInCheck(){let t=new v,e=[];e.push(!this.isInCheck(t));for(let i=0;i<e.length;i++)if(!e[i])throw new Error("Is in check failed, test "+(i+1)+" failed")}Piece(t){let e=t.x+t.y*8;for(let i=0;i<this.Pieces.length;i++)if(this.Pieces[i].getIndex()==e)return this.Pieces[i];return" "}addPiece(t){this.Pieces.push(t),this.board[t.getIndex()]!=null&&this.board[t.getIndex()]!=" "&&console.log("ERROR: PIECE ALREADY EXISTS AT THIS LOCATION",t),this.board[t.getIndex()]=t.type}findPawnMoves(t,e){let i=[],s=t.getIndex(),n=new f(s%8,Math.floor(s/8)),c=t.color;if(c!=this.currentTurnColor)return i;if(c=="white"){let o=new f(n.x,n.y-1);e.Piece(o)==" "&&i.push(new h(n,o));let l=new f(n.x,n.y-2);e.Piece(l)==" "&&e.Piece(o)==" "&&n.y==6&&i.push(new h(n,l));let a=new f(n.x-1,n.y-1);e.Piece(a)!=" "&&e.Piece(a)?.color=="black"&&i.push(new h(n,a));let u=new f(n.x+1,n.y-1);if(e.Piece(u)!=" "&&e.Piece(u)?.color=="black"&&i.push(new h(n,u)),e.enPassantTargetSquare!="-"&&s<=31&&s>=24){let d=new f(e.enPassantTargetSquare.charCodeAt(0)-97,8-parseInt(e.enPassantTargetSquare[1]));ke(d,u)===!0&&i.push(new h(n,u)),ke(d,a)===!0&&i.push(new h(n,a))}}else{let o=new f(n.x,n.y+1);e.Piece(o)==" "&&i.push(new h(n,o));let l=new f(n.x,n.y+2);e.Piece(l)==" "&&e.Piece(o)==" "&&n.y==1&&i.push(new h(n,l));let a=new f(n.x-1,n.y+1);e.Piece(a)!=" "&&e.Piece(a)?.color=="white"&&i.push(new h(n,a));let u=new f(n.x+1,n.y+1);if(e.Piece(u)!=" "&&e.Piece(u)?.color=="white"&&i.push(new h(n,u)),e.enPassantTargetSquare!="-"&&s<=15&&s>=8){let d=new f(e.enPassantTargetSquare.charCodeAt(0)-97,8-parseInt(e.enPassantTargetSquare[1]));u==d&&i.push(new h(n,u)),a==d&&i.push(new h(n,a))}}return i}testFindPawnMoves(){let t=new v,e=this.findPawnMoves(t.Piece(new f(0,6)),t),i=[];i.push(e.length==2),i.push(e[0].toString()=="a2-a3"),i.push(e[1].toString()=="a2-a4");for(let n=0;n<i.length;n++)if(i[n]==!1){console.log("testFindPawnMoves failed");return}i=[],e=this.findPawnMoves(t.Pieces[16],t),i.push(e.length==2),i.push(e[0].toString()=="a2-a3"),i.push(e[1].toString()=="a2-a4");for(let n=0;n<i.length;n++)if(i[n]==!1){console.log("testFindPawnMoves failed");return}t=new v([]);let s=new y("a5","black",qe);t.addPiece(s),s=new y("a4","white",qe),t.addPiece(s),e=this.findPawnMoves(s,t),i=[],i.push(e.length==0);for(let n=0;n<i.length;n++)if(i[n]==!1){console.error("testFindPawnMoves failed");return}}findRookMoves(t,e){let i=[],s=t.getIndex(),n=new f(s%8,Math.floor(s/8)),c=t.color;if(c!=e.currentTurnColor)return i;if(c==="white"){for(let o=n.y-1;o>=0;o--){let l=new f(n.x,o);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="black"){i.push(new h(n,l));break}else break}for(let o=n.y+1;o<=7;o++){let l=new f(n.x,o);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="black"){i.push(new h(n,l));break}else break}for(let o=n.x-1;o>=0;o--){let l=new f(o,n.y);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="black"){i.push(new h(n,l));break}else break}for(let o=n.x+1;o<=7;o++){let l=new f(o,n.y);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="black"){i.push(new h(n,l));break}else break}}else{for(let o=n.y-1;o>=0;o--){let l=new f(n.x,o);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="white"){i.push(new h(n,l));break}else break}for(let o=n.y+1;o<=7;o++){let l=new f(n.x,o);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="white"){i.push(new h(n,l));break}else break}for(let o=n.x-1;o>=0;o--){let l=new f(o,n.y);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="white"){i.push(new h(n,l));break}else break}for(let o=n.x+1;o<=7;o++){let l=new f(o,n.y);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="white"){i.push(new h(n,l));break}else break}}return i}testFindRookMoves(){let t=new v([],"rnbqkbnr/1ppppppp/8/p7/P7/8/1PPPPPPP/RNBQKBNR w KQkq a6 0 2"),e=t.findRookMoves(t.Piece(new f(0,7)),t),i=[];i.push(e.length===2);for(let s=0;s<i.length;s++)if(i[s]==!1){console.log("testFindRookMoves failed");return}}findKnightMoves(t,e){let i=[],s=t.getIndex(),n=new f(s%8,Math.floor(s/8)),c=t.color;if(c!=e.currentTurnColor)return i;if(c==="white"){if(n.x-2>=0&&n.y-1>=0){let o=new f(n.x-2,n.y-1);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="black"&&i.push(new h(n,o))}if(n.x+2<=7&&n.y-1>=0){let o=new f(n.x+2,n.y-1);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="black"&&i.push(new h(n,o))}if(n.x-2>=0&&n.y+1<=7){let o=new f(n.x-2,n.y+1);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="black"&&i.push(new h(n,o))}if(n.x+2<=7&&n.y+1<=7){let o=new f(n.x+2,n.y+1);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="black"&&i.push(new h(n,o))}if(n.x-1>=0&&n.y-2>=0){let o=new f(n.x-1,n.y-2);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="black"&&i.push(new h(n,o))}if(n.x-1>=0&&n.y+2<=7){let o=new f(n.x-1,n.y+2);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="black"&&i.push(new h(n,o))}if(n.x+1<=7&&n.y-2>=0){let o=new f(n.x+1,n.y-2);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="black"&&i.push(new h(n,o))}if(n.x+1<=7&&n.y+2<=7){let o=new f(n.x+1,n.y+2);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="black"&&i.push(new h(n,o))}}else{if(n.x-2>=0&&n.y-1>=0){let o=new f(n.x-2,n.y-1);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="white"&&i.push(new h(n,o))}if(n.x+2<=7&&n.y-1>=0){let o=new f(n.x+2,n.y-1);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="white"&&i.push(new h(n,o))}if(n.x-2>=0&&n.y+1<=7){let o=new f(n.x-2,n.y+1);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="white"&&i.push(new h(n,o))}if(n.x+2<=7&&n.y+1<=7){let o=new f(n.x+2,n.y+1);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="white"&&i.push(new h(n,o))}if(n.x-1>=0&&n.y-2>=0){let o=new f(n.x-1,n.y-2);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="white"&&i.push(new h(n,o))}if(n.x-1>=0&&n.y+2<=7){let o=new f(n.x-1,n.y+2);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="white"&&i.push(new h(n,o))}if(n.x+1<=7&&n.y-2>=0){let o=new f(n.x+1,n.y-2);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="white"&&i.push(new h(n,o))}if(n.x+1<=7&&n.y+2<=7){let o=new f(n.x+1,n.y+2);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="white"&&i.push(new h(n,o))}}return i}testFindKnightMoves(){let t=new v([]),e=[];t.currentTurnColor="white";let i=new y("c3","white",me);t.addPiece(i);let s=t.findKnightMoves(i,t);e.push(s.length===8),t=new v([]),i=new y("c3","black",me),t.addPiece(i),t.currentTurnColor="black",s=t.findKnightMoves(i,t),e.push(s.length===8),t=new v([]),i=new y("a1","white",me),t.addPiece(i),s=t.findKnightMoves(i,t),e.push(s.length===2);for(let n=0;n<e.length;n++)if(!e[n]){console.log("testFindKnightMoves failed at test "+n);return}}findBishopMoves(t,e){let i=[],s=t.getIndex(),n=new f(s%8,Math.floor(s/8)),c=t.color;if(c!=e.currentTurnColor)return i;if(c==="white"){for(let o=1;o<=7&&!(n.x-o<0||n.y-o<0);o++){let l=new f(n.x-o,n.y-o);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="black"){i.push(new h(n,l));break}else break}for(let o=1;o<=7&&!(n.x+o>7||n.y-o<0);o++){let l=new f(n.x+o,n.y-o);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="black"){i.push(new h(n,l));break}else break}for(let o=1;o<=7&&!(n.x-o<0||n.y+o>7);o++){let l=new f(n.x-o,n.y+o);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="black"){i.push(new h(n,l));break}else break}for(let o=1;o<=7&&!(n.x+o>7||n.y+o>7);o++){let l=new f(n.x+o,n.y+o);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="black"){i.push(new h(n,l));break}else break}}else{for(let o=1;o<=7&&!(n.x-o<0||n.y+o>7);o++){let l=new f(n.x-o,n.y+o);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="white"){i.push(new h(n,l));break}else break}for(let o=1;o<=7&&!(n.x+o>7||n.y+o>7);o++){let l=new f(n.x+o,n.y+o);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="white"){i.push(new h(n,l));break}else break}for(let o=1;o<=7&&!(n.x-o<0||n.y-o<0);o++){let l=new f(n.x-o,n.y-o);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="white"){i.push(new h(n,l));break}else break}for(let o=1;o<=7&&!(n.x+o>7||n.y-o<0);o++){let l=new f(n.x+o,n.y-o);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="white"){i.push(new h(n,l));break}else break}}return i}testFindBishopMoves(){let t=new v([]),e=new y("a2","white",ee);t.addPiece(e);let i=t.findBishopMoves(e,t);if(i.length!==7){console.log("testFindBishopMoves failed 0");return}if(t=new v([]),e=new y("a2","black",ee),t.addPiece(e),t.currentTurnColor="black",i=t.findBishopMoves(e,t),i.length!==7){console.log("testFindBishopMoves failed 1");return}if(t=new v([]),e=new y("a2","white",ee),t.addPiece(e),t.currentTurnColor="black",e=new y("b3","black",ee),t.addPiece(e),i=t.findBishopMoves(e,t),i.length!==9){console.log("testFindBishopMoves failed 2");return}if(t=new v([]),e=new y("a2","black",ee),t.addPiece(e),e=new y("b3","white",ee),t.addPiece(e),i=t.findBishopMoves(e,t),i.length!==9){console.log("testFindBishopMoves failed 3");return}}findQueenMoves(t,e){let i=this.findRookMoves(t,e);return i.push(...this.findBishopMoves(t,e)),i}testFindQueenMoves(){let t=new v([]),e=new y("a2","white",ne);t.addPiece(e);let i=t.findQueenMoves(e,t);if(i.length!==21){console.log(i),console.error("testFindQueenMoves failed 0");return}if(t=new v([]),e=new y("a2","black",ne),t.addPiece(e),t.currentTurnColor="black",i=t.findQueenMoves(e,t),i.length!==21){t.displayBoard(),console.log(i),console.error("testFindQueenMoves failed 1");return}if(t=new v([]),e=new y("a2","white",ne),t.addPiece(e),t.currentTurnColor="black",e=new y("b3","black",ne),t.addPiece(e),i=t.findQueenMoves(e,t),i.length!==23){console.error("testFindQueenMoves failed 2");return}if(t=new v([]),e=new y("a2","black",ne),t.addPiece(e),e=new y("b3","white",ne),t.addPiece(e),i=t.findQueenMoves(e,t),i.length!==23){console.error("testFindQueenMoves failed 3");return}}findKingMoves(t,e){let i=[],s=t.getPos().pos,n=new f(s.x,s.y+1);return t.color==="black"?(e.Piece(n)===" "&&s.y+1<=7?i.push(new h(s,n)):e.Piece(n)?.color==="white"&&i.push(new h(s,n)),n=new f(s.x,s.y-1),e.Piece(n)===" "&&s.y-1>=0?i.push(new h(s,n)):e.Piece(n)?.color==="white"&&i.push(new h(s,n)),n=new f(s.x+1,s.y),e.Piece(n)===" "&&s.x+1<=7?i.push(new h(s,n)):e.Piece(n)?.color==="white"&&i.push(new h(s,n)),n=new f(s.x-1,s.y),e.Piece(n)===" "&&s.x-1>=0?i.push(new h(s,n)):e.Piece(n)?.color==="white"&&i.push(new h(s,n)),n=new f(s.x+1,s.y+1),e.Piece(n)===" "&&s.x+1<=7&&s.y+1<=7?i.push(new h(s,n)):e.Piece(n)?.color==="white"&&i.push(new h(s,n)),n=new f(s.x-1,s.y+1),e.Piece(n)===" "&&s.x-1>=0&&s.y+1<=7?i.push(new h(s,n)):e.Piece(n)?.color==="white"&&i.push(new h(s,n)),n=new f(s.x+1,s.y-1),e.Piece(n)===" "&&s.x+1<=7&&s.y-1>=0?i.push(new h(s,n)):e.Piece(n)?.color==="white"&&i.push(new h(s,n)),n=new f(s.x-1,s.y-1),e.Piece(n)===" "&&s.x-1>=0&&s.y-1>=0?i.push(new h(s,n)):e.Piece(n)?.color==="white"&&i.push(new h(s,n)),n=new f(s.x+2,s.y),e.Piece(n)===" "&&s.x+2===6&&s.y===0&&this.inCheck===!1&&e.Piece(new f(s.x+1,s.y))===" "&&e.castlingRights.includes("k")&&i.push(new h(s,n)),n=new f(s.x-2,s.y),e.Piece(n)===" "&&s.x-2===2&&s.y===0&&this.inCheck===!1&&e.Piece(new f(s.x-1,s.y))===" "&&e.Piece(n)===" "&&e.castlingRights.includes("q")&&i.push(new h(s,n))):(n=new f(s.x,s.y+1),e.Piece(n)===" "&&s.y+1<=7?i.push(new h(s,n)):e.Piece(n)?.color==="black"&&i.push(new h(s,n)),n=new f(s.x,s.y-1),e.Piece(n)===" "&&s.y-1>=0?i.push(new h(s,n)):e.Piece(n)?.color==="black"&&i.push(new h(s,n)),n=new f(s.x+1,s.y),e.Piece(n)===" "&&s.x+1<=7?i.push(new h(s,n)):e.Piece(n)?.color==="black"&&i.push(new h(s,n)),n=new f(s.x-1,s.y),e.Piece(n)===" "&&s.x-1>=0?i.push(new h(s,n)):e.Piece(n)?.color==="black"&&i.push(new h(s,n)),n=new f(s.x+1,s.y+1),e.Piece(n)===" "&&s.x+1<=7&&s.y+1<=7?i.push(new h(s,n)):e.Piece(n)?.color==="black"&&i.push(new h(s,n)),n=new f(s.x-1,s.y+1),e.Piece(n)===" "&&s.x-1>=0&&s.y+1<=7?i.push(new h(s,n)):e.Piece(n)?.color==="black"&&i.push(new h(s,n)),n=new f(s.x+1,s.y-1),e.Piece(n)===" "&&s.x+1<=7&&s.y-1>=0?i.push(new h(s,n)):e.Piece(n)?.color==="black"&&i.push(new h(s,n)),n=new f(s.x-1,s.y-1),e.Piece(n)===" "&&s.x-1>=0&&s.y-1>=0?i.push(new h(s,n)):e.Piece(n)?.color==="black"&&i.push(new h(s,n)),n=new f(s.x+2,s.y),e.Piece(n)===" "&&s.x+2===6&&s.y===7&&this.inCheck===!1&&e.Piece(new f(s.x+1,s.y))===" "&&e.castlingRights.includes("K")&&i.push(new h(s,n)),n=new f(s.x-2,s.y),e.Piece(n)===" "&&s.x-2===2&&s.y===7&&this.inCheck===!1&&e.Piece(new f(s.x-1,s.y))===" "&&e.Piece(n)===" "&&e.castlingRights.includes("Q")&&i.push(new h(s,n))),i}testFindKingMoves(){let t=new v([]),e=new y("a2","white",te);t.addPiece(e);let i=t.findKingMoves(e,t);if(i.length!==5){console.error("testFindKingMoves failed 0",i);return}if(t=new v([]),e=new y("a2","black",te),t.addPiece(e),t.currentTurnColor="black",i=t.findKingMoves(e,t),i.length!==5){console.error("testFindKingMoves failed 1");return}if(t=new v([]),e=new y("a2","white",te),t.addPiece(e),t.currentTurnColor="black",e=new y("b3","black",te),t.addPiece(e),i=t.findKingMoves(e,t),i.length!==8){console.error("testFindKingMoves failed 2");return}if(t=new v([]),e=new y("a2","black",te),t.addPiece(e),e=new y("b3","white",te),t.addPiece(e),i=t.findKingMoves(e,t),i.length!==8){console.error("testFindKingMoves failed 3");return}}runAllTests(){this.testConvertToPosition(),this.testConstructors(),this.testBoardToFen(),this.testFenToBoard(),this.testFindPawnMoves(),this.testFindRookMoves(),this.testFindKnightMoves(),this.testFindBishopMoves(),this.testFindQueenMoves(),this.testFindKingMoves(),this.testFindPseudoLegalMoves(),this.testIsInCheck(),this.testFindLegalMoves(),console.log("All tests ran for board class")}}class Xe{runAllTests(){new h(void 0,void 0,"a2","a4").runAllTests(),new ie("a2").runAllTests(),new y("a2","white","pawn").runAllTests(),new v().runAllTests(),console.log("All tests ran for chessClasses.ts")}}function ke(r,t){return r&&t&&typeof r=="object"&&typeof t=="object"?Object.keys(r).length===Object.keys(t).length&&Object.keys(r).reduce(function(e,i){return e&&ke(r[i],t[i])},!0):r===t}const _e=rt();function Ve(r){k(0),k("Home");const[t,e]=k({x:0,y:0}),[i,s]=k({x:0,y:0}),[n,c]=k([]),[o,l]=k(!1),[a,u]=k(null),[d,P]=k(null),[g,R]=k({x:0,y:0}),[b,$]=k(null),[F,N]=k(null),S=[],T=[];se(()=>{document.addEventListener("pointermove",w=>{e({x:w.clientX,y:w.clientY}),o()&&a()&&(a().ref.style.transform=`translate(${t().x-i().x+g().x}px, ${t().y-i().y+g().y}px)`,a().ref.style.zIndex=100,a().rectangle=a().ref.getBoundingClientRect(),b()?.length>0&&N(ze(b())))}),document.addEventListener("pointerup",()=>{a()!=null&&(a().dragEnd(F()),T.forEach(w=>{w()}),a()?.ref&&(a().ref.style.transform=`translate(${0}px, ${0}px)`,a().ref.style.zIndex=0),l(!1),P(a()),u(null))})});const q=(w,p)=>{p!==void 0&&p.dragStart.push(w)},Q=w=>{S.push(w)},B=w=>{T.push(w)},x=(w,p)=>{p!==void 0&&(p.dragEnd=w)},I=(w,p)=>{p!==void 0&&(p.hoverOver=w)},D=(w,p)=>{p!==void 0&&(p.hoverOut=w)},Y=w=>{let p={id:w,startingPosition:{x:0,y:0},dragStart:[],dragEnd:()=>{},ref:null,rectangle:null,data:{}};return se(()=>{p.ref.addEventListener("pointerdown",K=>{for(let L=0;L<p.dragStart.length;L++)p.dragStart[L](p);for(let L=0;L<S.length;L++)S[L](p);R(Ye(K.target.getAttribute("style"))),s({x:K.clientX,y:K.clientY}),l(!0),u(p),p.rectangle=p.ref.getBoundingClientRect()})}),p},U=w=>{let p={id:w,startingPosition:{x:0,y:0},hoverOver:()=>{},hoverOut:()=>{},ref:null,rectangle:null,hovering:!1,occupied:!1,droppable:!0};return c([...n(),p]),se(()=>{p.rectangle=p.ref.getBoundingClientRect(),p.ref.children.length>0&&(p.occupied=!0),document.addEventListener("pointermove",()=>{if(a()==null||a().rectangle==null)return;let K=a().ref.getBoundingClientRect(),L=p.ref.getBoundingClientRect();if(K.top>L.bottom||K.right<L.left||K.bottom<L.top||K.left>L.right){if(Ze(p),!p.hovering)return;p.hovering=!1,p.hoverOut(a())}else{if(p.ref===F()?.ref){if(p.hovering)return;p.hovering=!0,p.hoverOver(a())}else p.hovering=!1,p.hoverOut(a());We(p)}}),document.addEventListener("pointerup",()=>{!p.hovering||(p.hovering=!1,p.hoverOut(d()),d()!=null&&p.droppable!==!1&&(p.ref.children.length>0&&p.ref.children[0].remove(),p.ref.appendChild(d().ref)))})}),n()[n().length-1]};function Ye(w){if(w===null)return{x:0,y:0};let p=w.split("translate(")[0],K;return p&&(K=w.split("translate(")[1].split(")")[0].split("px, ")),{x:parseInt(K[0]),y:parseInt(K[1])}}function We(w){b()==null&&$([w]),!b().includes(w)&&(b()?.includes(w)||$([...b(),w]))}function Ze(w){b()!=null&&(!b()?.includes(w)||b().includes(w)&&$(b()?.filter(p=>p!==w)))}function ze(w){if(w==null)return;let p=a().ref.getBoundingClientRect();return w.sort((L,et)=>{let W=L.ref.getBoundingClientRect(),Z=et.ref.getBoundingClientRect(),we,ve,xe,ye,Me,Ee;return p.x>W.x?we=W.right-p.x:we=p.right-W.x,p.bottom>W.bottom?ve=W.bottom-p.top:ve=p.bottom-W.top,Me=we*ve,p.x>Z.x?xe=Z.right-p.x:xe=p.right-Z.x,p.bottom>Z.bottom?ye=Z.bottom-p.top:ye=p.bottom-Z.top,Ee=xe*ye,Ee-Me})[0]}return E(_e.Provider,{value:{onDragEnd:x,onDragStart:q,createDraggable:Y,onHoverOver:I,createDroppable:U,onHoverOut:D,onGlobalDragStart:Q,onGlobalDragEnd:B},get children(){return r.children}})}const Fe=()=>lt(_e),yt=J("<div></div>"),mt=J('<section><div class=""> </div></section>');function Je({pieceClassName:r,className:t,id:e,board:i,draggableId:s,updateBoard:n,eatenPieces:c,setDisplayInlay:o,setDisplayInlayX:l,inlaySelection:a,displayInlay:u,style:d}){const P=({id:b,className:$,draggable:F,draggableClass:N})=>{const{onHoverOver:S,createDroppable:T,onHoverOut:q,onGlobalDragStart:Q,onGlobalDragEnd:B}=Fe(),x=T(b);return S(I=>{x.ref.classList.add("hovered")},x),q(I=>{x.ref.classList.remove("hovered")},x),Q(I=>{if(!u())if(I.data.legalPieceMoves.includes(x.id))if(x.ref.children.length===0){x.droppable=!0;let D=document.createElement("section");D.classList.add("circle"),x.ref.appendChild(D)}else x.ref.children.length===1&&(x.droppable=!0,x.ref.children[0].children[0].classList.add("circle"));else x.droppable=!1}),B(I=>{let D=x.ref.querySelectorAll("section.circle");for(let U=0;U<D.length;U++)D[U].remove();let Y=x.ref.querySelectorAll("div.circle");for(let U=0;U<Y.length;U++)Y[U].classList.remove("circle")}),F.getAttribute("class").length===0&&(F=void 0),(()=>{const I=yt.cloneNode(!0),D=x.ref;return typeof D=="function"?$e(D,I):x.ref=I,be(I,"id",b),fe(I,$),Pe(I,E(ge,{when:F!=null,children:F})),V(Y=>vt(I,d,Y)),I})()},g=({className:b,id:$})=>{const{onDragStart:F,onDragEnd:N,createDraggable:S}=Fe(),T=S($);let q,Q;return F(()=>{if(u())return;q=T.ref.parentElement.id;let B=i.findLegalMoves(i),x=[];for(let I=0;I<B.length;I++)B[I].start==q&&x.push(B[I].end);T.data.legalPieceMoves=x},T),N(async B=>{if(u()||B===null)return;B.occupied=!1;let x=B.ref.children[0];if(await R(1),!!B.ref.children[0]&&B.ref.children[0].id===T.id){if(Q=T.ref.parentElement.id,Q===q)return;i.board,i.movePiece(q,Q),x.classList.contains("piece")&&(c.push(x),console.log(c)),i.board,console.log(i.inCheck);let I=i.getPieceAtPosition(Q);I.type==="p"&&(I.color==="white"?Q[1]==="8"&&(o(!0),l(I.position.pos.x)):Q[1]==="1"&&(o(!0),l(I.position.pos.x))),n(),i.displayBoard()}},T),(()=>{const B=mt.cloneNode(!0),x=T.ref;return typeof x=="function"?$e(x,B):T.ref=B,fe(B,b),be(B,"id",$),B})()},R=b=>new Promise($=>setTimeout($,b));return E(P,{className:t,get draggable(){return E(g,{className:`${r!=" "?r+" piece":""}`,id:s})},id:e})}const It=J('<div><div class="chessInlaySquare" id="queenSelection"><section class="piece Q"></section></div><div class="chessInlaySquare" id="knightSelection"><section class="piece N"></section></div><div class="chessInlaySquare" id="rookSelection"><section class="piece R"></section></div><div class="chessInlaySquare" id="bishopSelection"><section class="piece B"></section></div></div>'),bt=J('<div class="chessBoard"></div>');let Tt=new Xe;Tt.runAllTests();let m=new v;m.displayBoard();let kt=Bt();function Bt(){let r=[];for(let t=0;t<8;t++)for(let e=0;e<8;e++)r.push(`${String.fromCharCode(97+e)}${8-t}`);return r}function Ct({}){let r=[];const[t,e]=k(!1),[i,s]=k("00"),[n,c]=k("");function o(){let a=document.querySelectorAll(".chessSquare"),u=[];for(let g=0;g<a.length;g++)a[g].children[0]!=null?u.push(a[g].children[0].classList[0]):u.push(" ");let d,P;for(let g=0;g<64;g++)u[g]!=m.board[g]&&(u[g]==" "&&m.board[g]!=" "?(P=a[g],d!=null&&(a[g].appendChild(d),d=void 0)):u[g]!=" "&&m.board[g]==" "&&(d=a[g].children[0],P!=null&&(P.appendChild(d),d=void 0,P=void 0)));d?.parentElement?.removeChild(d)}i()+"";function l(a){c(a),e(!1);let u=m.getPieceAtBoardIndex(parseInt(i())),d=u.type;u.type=a,m.board[parseInt(i())]=a,m.displayBoard(),console.log(u);let P=document.getElementById(u.position.position)?.children[0];console.log("previous type:"+d),P?.classList.remove(d.toUpperCase()),P?.classList.add(a.toUpperCase()),o()}return(()=>{const a=bt.cloneNode(!0);return Pe(a,E(Ve,{get children(){return[E(ge,{get when(){return t()},get children(){const u=It.cloneNode(!0),d=u.firstChild,P=d.nextSibling,g=P.nextSibling,R=g.nextSibling;return d.$$click=()=>l("q"),P.$$click=()=>l("n"),g.$$click=()=>l("r"),R.$$click=()=>l("b"),V(()=>fe(u,`chessInlay ml-[${i()}]`)),u}}),E(Ge,{get each(){return m.board},children:(u,d)=>E(Je,{get pieceClassName(){return m.board[d()]},get className(){return`chessSquare ${d()%16<8?d()%2==0?"lighterBackground":"":d()%2==0?"":"lighterBackground"}`},get id(){return kt[d()]},board:m,updateBoard:o,get draggableId(){return St()},eatenPieces:r,setDisplayInlay:e,setDisplayInlayX:s,inlaySelection:n,displayInlay:t})})]}})),a})()}function St(){return Math.random().toString(36).substr(2,9)}Se(["click"]);const Mt=J('<div><div class="chessInlaySquare" id="queenSelection"><section class="piece q"></section></div><div class="chessInlaySquare" id="knightSelection"><section class="piece n"></section></div><div class="chessInlaySquare" id="rookSelection"><section class="piece r"></section></div><div class="chessInlaySquare" id="bishopSelection"><section class="piece b"></section></div></div>'),Et=J('<div class="chessBoard"></div>');let At=new Xe;At.runAllTests();m.displayBoard();let Rt=$t();function $t(){let r=[];for(let t=0;t<8;t++)for(let e=0;e<8;e++)r.push(`${String.fromCharCode(97+e)}${8-t}`);return r}function Nt(r){let t=[];for(let e=r.length-1;e>=0;e--)t.push(r[e]);return t}function qt({}){let r=[];const[t,e]=k(!1),[i,s]=k(0),[n,c]=k("");function o(){let a=document.querySelectorAll(".chessSquare"),u=[];a=Nt(a);for(let g=0;g<a.length;g++)a[g].children[0]!=null?u.push(a[g].children[0].classList[0]):u.push(" ");let d,P;for(let g=0;g<64;g++)u[g]!=m.board[g]&&(u[g]==" "&&m.board[g]!=" "?(P=a[g],d!=null&&(a[g].appendChild(d),d=void 0)):u[g]!=" "&&m.board[g]==" "&&(d=a[g].children[0],P!=null&&(P.appendChild(d),d=void 0,P=void 0)));d?.parentElement?.removeChild(d)}function l(a){c(a),e(!1);let u=m.getPieceAtBoardIndex(63-(7-i())),d=u.type;console.log(u),u.type=a,m.board[63-(7-i())]=a,m.displayBoard(),console.log(u);let P=document.getElementById(u.position.position).children[0];console.log("previous type:"+d),P.classList.remove(d),P.classList.add(a),o()}return(()=>{const a=Et.cloneNode(!0);return Pe(a,E(Ve,{get children(){return[E(ge,{get when(){return t()},get children(){const u=Mt.cloneNode(!0),d=u.firstChild,P=d.nextSibling,g=P.nextSibling,R=g.nextSibling;return d.$$click=()=>l("q"),P.$$click=()=>l("n"),g.$$click=()=>l("r"),R.$$click=()=>l("b"),V(()=>fe(u,`chessInlay ml-[${7-i()}]`)),u}}),E(Ge,{get each(){return m.board},children:(u,d)=>E(Je,{get style(){return H(()=>d()==0)()?"border-top-left-radius: 40%;":H(()=>d()==7)()?"border-top-right-radius: 40%;":H(()=>d()==56)()?"border-bottom-left-radius: 40%;":d()==63?"border-bottom-right-radius: 40%;":"border-radius: 0%;"},get pieceClassName(){return m.board[m.board.length-1-d()]},get className(){return`chessSquare ${(m.board.length-1-d())%16<8?(m.board.length-1-d())%2==0?"lighterBackground":"":(m.board.length-1-d())%2==0?"":"lighterBackground"}`},get id(){return Rt[m.board.length-1-d()]},board:m,updateBoard:o,get draggableId(){return Ft()},eatenPieces:r,setDisplayInlay:e,setDisplayInlayX:s,inlaySelection:n,displayInlay:t})})]}})),a})()}function Ft(){return Math.random().toString(36).substr(2,9)}Se(["click"]);const Lt=J(`<div class="glassOverlay"><label for="username">Choose your username</label><div class="userNameInput"><input type="username" placeholder="username" id="userNameInput"></div><button class="submitUsernameButton">LET'S GO<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 arrow"><path stroke-linecap="round" stroke-linejoin="round" d="M17.25 8.25L21 12m0 0l-3.75 3.75M21 12H3"></path></svg></button></div>`),Kt=({userName:r,userId:t})=>{const[e,i]=k(""),[s,n]=k(""),c=()=>{let o=Qt(),l=e();if(l==""){alert("Please enter a username");return}if(e()==r()){console.log("userid: ",o),console.log("username: ",l),console.log("kept from local storage");let u=document.getElementById("userNameInput");u.value="",i("");return}console.log("userid: ",o),console.log("username: ",l),sessionStorage.setItem("gabrielmalek/chess.data",JSON.stringify({userId:o,userName:l})),localStorage.setItem("gabrielmalek/chess.data",JSON.stringify({userId:o,userName:l}));let a=document.getElementById("userNameInput");a.value="",i("")};return se(()=>{if(document.addEventListener("keyup",function(o){o.key==="Enter"&&c()}),console.log("username: ",e()),console.log(r()),r()!=""){i(r()),n(t());let o=document.getElementById("userNameInput");o.value=e()}}),(()=>{const o=Lt.cloneNode(!0),l=o.firstChild,a=l.nextSibling,u=a.firstChild,d=a.nextSibling;return u.$$keyup=P=>i(P.target?.value),d.$$click=()=>c(),o})()};function Qt(){let r="";for(let t=0;t<20;t++)r+=Math.floor(Math.random()*10);return r}Se(["keyup","click"]);function Dt({}){const[r,t]=k(""),[e,i]=k("");se(()=>{s()});function s(){let n=sessionStorage.getItem("gabrielmalek/chess.data"),c=JSON.parse(n);if(n==null)console.log("session storage null");else{console.log("session storage not null"),i(c.userId),t(c.userName);return}if(n=localStorage.getItem("gabrielmalek/chess.data"),n==null)console.log("local storage null");else return}return[E(Kt,{userName:r,userId:e}),E(ge,{when:!1,get children(){return E(Ct,{})}}),E(qt,{})]}const Ot=()=>E(Dt,{});wt(()=>E(Ot,{}),document.getElementById("root"));
