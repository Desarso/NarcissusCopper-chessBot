(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();const D={};function tt(r){D.context=r}const nt=(r,t)=>r===t,it=Symbol("solid-track"),re={equals:nt};let Ne=Qe;const j=1,le=2,Fe={owned:null,cleanups:null,context:null,owner:null};var A=null;let X=null,S=null,$=null,U=null,me=0;function oe(r,t){const e=S,i=A,s=r.length===0,n=s?Fe:{owned:null,cleanups:null,context:null,owner:t||i},c=s?r:()=>r(()=>H(()=>ae(n)));A=n,S=null;try{return ie(c,!0)}finally{S=e,A=i}}function M(r,t){t=t?Object.assign({},re,t):re;const e={value:r,observers:null,observerSlots:null,comparator:t.equals||void 0},i=s=>(typeof s=="function"&&(s=s(e.value)),Le(e,s));return[Ke.bind(e),i]}function z(r,t,e){const i=ke(r,t,!1,j);ne(i)}function st(r,t,e){Ne=ft;const i=ke(r,t,!1,j);i.user=!0,U?U.push(i):ne(i)}function te(r,t,e){e=e?Object.assign({},re,e):re;const i=ke(r,t,!0,0);return i.observers=null,i.observerSlots=null,i.comparator=e.equals||void 0,ne(i),Ke.bind(i)}function H(r){const t=S;S=null;try{return r()}finally{S=t}}function xe(r){st(()=>H(r))}function ot(r){return A===null||(A.cleanups===null?A.cleanups=[r]:A.cleanups.push(r)),r}function rt(r,t){const e=Symbol("context");return{id:e,Provider:dt(e),defaultValue:r}}function lt(r){let t;return(t=Ue(A,r.id))!==void 0?t:r.defaultValue}function ct(r){const t=te(r),e=te(()=>Te(t()));return e.toArray=()=>{const i=e();return Array.isArray(i)?i:i!=null?[i]:[]},e}function Ke(){const r=X;if(this.sources&&(this.state||r))if(this.state===j||r)ne(this);else{const t=$;$=null,ie(()=>he(this),!1),$=t}if(S){const t=this.observers?this.observers.length:0;S.sources?(S.sources.push(this),S.sourceSlots.push(t)):(S.sources=[this],S.sourceSlots=[t]),this.observers?(this.observers.push(S),this.observerSlots.push(S.sources.length-1)):(this.observers=[S],this.observerSlots=[S.sources.length-1])}return this.value}function Le(r,t,e){let i=r.value;return(!r.comparator||!r.comparator(i,t))&&(r.value=t,r.observers&&r.observers.length&&ie(()=>{for(let s=0;s<r.observers.length;s+=1){const n=r.observers[s],c=X&&X.running;c&&X.disposed.has(n),(c&&!n.tState||!c&&!n.state)&&(n.pure?$.push(n):U.push(n),n.observers&&De(n)),c||(n.state=j)}if($.length>1e6)throw $=[],new Error},!1)),t}function ne(r){if(!r.fn)return;ae(r);const t=A,e=S,i=me;S=A=r,ht(r,r.value,i),S=e,A=t}function ht(r,t,e){let i;try{i=r.fn(t)}catch(s){r.pure&&(r.state=j,r.owned&&r.owned.forEach(ae),r.owned=null),Oe(s)}(!r.updatedAt||r.updatedAt<=e)&&(r.updatedAt!=null&&"observers"in r?Le(r,i):r.value=i,r.updatedAt=e)}function ke(r,t,e,i=j,s){const n={fn:r,state:i,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:A,context:null,pure:e};return A===null||A!==Fe&&(A.owned?A.owned.push(n):A.owned=[n]),n}function ce(r){const t=X;if(r.state===0||t)return;if(r.state===le||t)return he(r);if(r.suspense&&H(r.suspense.inFallback))return r.suspense.effects.push(r);const e=[r];for(;(r=r.owner)&&(!r.updatedAt||r.updatedAt<me);)(r.state||t)&&e.push(r);for(let i=e.length-1;i>=0;i--)if(r=e[i],r.state===j||t)ne(r);else if(r.state===le||t){const s=$;$=null,ie(()=>he(r,e[0]),!1),$=s}}function ie(r,t){if($)return r();let e=!1;t||($=[]),U?e=!0:U=[],me++;try{const i=r();return ut(e),i}catch(i){$||(U=null),Oe(i)}}function ut(r){if($&&(Qe($),$=null),r)return;const t=U;U=null,t.length&&ie(()=>Ne(t),!1)}function Qe(r){for(let t=0;t<r.length;t++)ce(r[t])}function ft(r){let t,e=0;for(t=0;t<r.length;t++){const i=r[t];i.user?r[e++]=i:ce(i)}for(D.context&&tt(),t=0;t<e;t++)ce(r[t])}function he(r,t){const e=X;r.state=0;for(let i=0;i<r.sources.length;i+=1){const s=r.sources[i];s.sources&&(s.state===j||e?s!==t&&ce(s):(s.state===le||e)&&he(s,t))}}function De(r){const t=X;for(let e=0;e<r.observers.length;e+=1){const i=r.observers[e];(!i.state||t)&&(i.state=le,i.pure?$.push(i):U.push(i),i.observers&&De(i))}}function ae(r){let t;if(r.sources)for(;r.sources.length;){const e=r.sources.pop(),i=r.sourceSlots.pop(),s=e.observers;if(s&&s.length){const n=s.pop(),c=e.observerSlots.pop();i<s.length&&(n.sourceSlots[c]=i,s[i]=n,e.observerSlots[i]=c)}}if(r.owned){for(t=0;t<r.owned.length;t++)ae(r.owned[t]);r.owned=null}if(r.cleanups){for(t=0;t<r.cleanups.length;t++)r.cleanups[t]();r.cleanups=null}r.state=0,r.context=null}function at(r){return r instanceof Error||typeof r=="string"?r:new Error("Unknown error")}function Oe(r){throw r=at(r),r}function Ue(r,t){return r?r.context&&r.context[t]!==void 0?r.context[t]:Ue(r.owner,t):void 0}function Te(r){if(typeof r=="function"&&!r.length)return Te(r());if(Array.isArray(r)){const t=[];for(let e=0;e<r.length;e++){const i=Te(r[e]);Array.isArray(i)?t.push.apply(t,i):t.push(i)}return t}return r}function dt(r,t){return function(i){let s;return z(()=>s=H(()=>(A.context={[r]:i.value},ct(()=>i.children))),void 0),s}}const pt=Symbol("fallback");function Se(r){for(let t=0;t<r.length;t++)r[t]()}function gt(r,t,e={}){let i=[],s=[],n=[],c=0,o=t.length>1?[]:null;return ot(()=>Se(n)),()=>{let l=r()||[],f,u;return l[it],H(()=>{let P=l.length,g,B,b,N,L,q,y,C,E;if(P===0)c!==0&&(Se(n),n=[],i=[],s=[],c=0,o&&(o=[])),e.fallback&&(i=[pt],s[0]=oe(k=>(n[0]=k,e.fallback())),c=1);else if(c===0){for(s=new Array(P),u=0;u<P;u++)i[u]=l[u],s[u]=oe(d);c=P}else{for(b=new Array(P),N=new Array(P),o&&(L=new Array(P)),q=0,y=Math.min(c,P);q<y&&i[q]===l[q];q++);for(y=c-1,C=P-1;y>=q&&C>=q&&i[y]===l[C];y--,C--)b[C]=s[y],N[C]=n[y],o&&(L[C]=o[y]);for(g=new Map,B=new Array(C+1),u=C;u>=q;u--)E=l[u],f=g.get(E),B[u]=f===void 0?-1:f,g.set(E,u);for(f=q;f<=y;f++)E=i[f],u=g.get(E),u!==void 0&&u!==-1?(b[u]=s[f],N[u]=n[f],o&&(L[u]=o[f]),u=B[u],g.set(E,u)):n[f]();for(u=q;u<P;u++)u in b?(s[u]=b[u],n[u]=N[u],o&&(o[u]=L[u],o[u](u))):s[u]=oe(d);s=s.slice(0,c=P),i=l.slice(0)}return s});function d(P){if(n[u]=P,o){const[g,B]=M(u);return o[u]=B,t(l[u],g)}return t(l[u])}}}function R(r,t){return H(()=>r(t||{}))}function je(r){const t="fallback"in r&&{fallback:()=>r.fallback};return te(gt(()=>r.each,r.children,t||void 0))}function de(r){let t=!1;const e=r.keyed,i=te(()=>r.when,void 0,{equals:(s,n)=>t?s===n:!s==!n});return te(()=>{const s=i();if(s){const n=r.children,c=typeof n=="function"&&n.length>0;return t=e||c,c?H(()=>n(s)):n}return r.fallback},void 0,void 0)}function Pt(r,t,e){let i=e.length,s=t.length,n=i,c=0,o=0,l=t[s-1].nextSibling,f=null;for(;c<s||o<n;){if(t[c]===e[o]){c++,o++;continue}for(;t[s-1]===e[n-1];)s--,n--;if(s===c){const u=n<i?o?e[o-1].nextSibling:e[n-o]:l;for(;o<n;)r.insertBefore(e[o++],u)}else if(n===o)for(;c<s;)(!f||!f.has(t[c]))&&t[c].remove(),c++;else if(t[c]===e[n-1]&&e[o]===t[s-1]){const u=t[--s].nextSibling;r.insertBefore(e[o++],t[c++].nextSibling),r.insertBefore(e[--n],u),t[s]=e[n]}else{if(!f){f=new Map;let d=o;for(;d<n;)f.set(e[d],d++)}const u=f.get(t[c]);if(u!=null)if(o<u&&u<n){let d=c,P=1,g;for(;++d<s&&d<n&&!((g=f.get(t[d]))==null||g!==u+P);)P++;if(P>u-o){const B=t[c];for(;o<u;)r.insertBefore(e[o++],B)}else r.replaceChild(e[o++],t[c++])}else c++;else t[c++].remove()}}}const Me="_$DX_DELEGATE";function wt(r,t,e,i={}){let s;return oe(n=>{s=n,t===document?r():pe(t,r(),t.firstChild?null:void 0,e)},i.owner),()=>{s(),t.textContent=""}}function ee(r,t,e){const i=document.createElement("template");i.innerHTML=r;let s=i.content.firstChild;return e&&(s=s.firstChild),s}function He(r,t=window.document){const e=t[Me]||(t[Me]=new Set);for(let i=0,s=r.length;i<s;i++){const n=r[i];e.has(n)||(e.add(n),t.addEventListener(n,vt))}}function Ae(r,t,e){e==null?r.removeAttribute(t):r.setAttribute(t,e)}function ue(r,t){t==null?r.removeAttribute("class"):r.className=t}function Ee(r,t,e){return H(()=>r(t,e))}function pe(r,t,e,i){if(e!==void 0&&!i&&(i=[]),typeof t!="function")return fe(r,t,i,e);z(s=>fe(r,t(),s,e),i)}function vt(r){const t=`$$${r.type}`;let e=r.composedPath&&r.composedPath()[0]||r.target;for(r.target!==e&&Object.defineProperty(r,"target",{configurable:!0,value:e}),Object.defineProperty(r,"currentTarget",{configurable:!0,get(){return e||document}}),D.registry&&!D.done&&(D.done=!0,document.querySelectorAll("[id^=pl-]").forEach(i=>{for(;i&&i.nodeType!==8&&i.nodeValue!=="pl-"+r;){let s=i.nextSibling;i.remove(),i=s}i&&i.remove()}));e;){const i=e[t];if(i&&!e.disabled){const s=e[`${t}Data`];if(s!==void 0?i.call(e,s,r):i.call(e,r),r.cancelBubble)return}e=e._$host||e.parentNode||e.host}}function fe(r,t,e,i,s){for(D.context&&!e&&(e=[...r.childNodes]);typeof e=="function";)e=e();if(t===e)return e;const n=typeof t,c=i!==void 0;if(r=c&&e[0]&&e[0].parentNode||r,n==="string"||n==="number"){if(D.context)return e;if(n==="number"&&(t=t.toString()),c){let o=e[0];o&&o.nodeType===3?o.data=t:o=document.createTextNode(t),e=Y(r,e,i,o)}else e!==""&&typeof e=="string"?e=r.firstChild.data=t:e=r.textContent=t}else if(t==null||n==="boolean"){if(D.context)return e;e=Y(r,e,i)}else{if(n==="function")return z(()=>{let o=t();for(;typeof o=="function";)o=o();e=fe(r,o,e,i)}),()=>e;if(Array.isArray(t)){const o=[],l=e&&Array.isArray(e);if(Ie(o,t,e,s))return z(()=>e=fe(r,o,e,i,!0)),()=>e;if(D.context){if(!o.length)return e;for(let f=0;f<o.length;f++)if(o[f].parentNode)return e=o}if(o.length===0){if(e=Y(r,e,i),c)return e}else l?e.length===0?Re(r,o,i):Pt(r,e,o):(e&&Y(r),Re(r,o));e=o}else if(t instanceof Node){if(D.context&&t.parentNode)return e=c?[t]:t;if(Array.isArray(e)){if(c)return e=Y(r,e,i,t);Y(r,e,null,t)}else e==null||e===""||!r.firstChild?r.appendChild(t):r.replaceChild(t,r.firstChild);e=t}}return e}function Ie(r,t,e,i){let s=!1;for(let n=0,c=t.length;n<c;n++){let o=t[n],l=e&&e[n];if(o instanceof Node)r.push(o);else if(!(o==null||o===!0||o===!1))if(Array.isArray(o))s=Ie(r,o,l)||s;else if(typeof o=="function")if(i){for(;typeof o=="function";)o=o();s=Ie(r,Array.isArray(o)?o:[o],Array.isArray(l)?l:[l])||s}else r.push(o),s=!0;else{const f=String(o);l&&l.nodeType===3&&l.data===f?r.push(l):r.push(document.createTextNode(f))}}return s}function Re(r,t,e=null){for(let i=0,s=t.length;i<s;i++)r.insertBefore(t[i],e)}function Y(r,t,e,i){if(e===void 0)return r.textContent="";const s=i||document.createTextNode("");if(t.length){let n=!1;for(let c=t.length-1;c>=0;c--){const o=t[c];if(s!==o){const l=o.parentNode===r;!n&&!c?l?r.replaceChild(s,o):r.insertBefore(s,e):l&&o.remove()}else n=!0}}else r.insertBefore(s,e);return[s]}const W="b",_="k",ye="n",qe="p",J="q";class a{x;y;constructor(t,e){this.x=t,this.y=e}}class h{start;end;boardStartIndex;boardEndIndex;constructor(t,e,i,s){if(i&&(this.start=i),s&&(this.end=s),i&&s){this.boardStartIndex=this.convertToBoardIndex(i),this.boardEndIndex=this.convertToBoardIndex(s);return}t&&e?(this.boardStartIndex=t.x+t.y*8,this.boardEndIndex=e.x+e.y*8,this.start=this.convertToBoardPosition(this.boardStartIndex),this.end=this.convertToBoardPosition(this.boardEndIndex)):(this.start="a8",this.end="a8",this.boardStartIndex=0,this.boardEndIndex=0)}toString(){return this.start+"-"+this.end}convertToBoardIndex(t){if(t.length!=2)throw new Error("Invalid position");let e=t[0],i=t[1],s=e.charCodeAt(0)-97,n=8-parseInt(i);return s+n*8}convertToBoardPosition(t){if(t<0||t>63)throw new Error("Invalid index: "+t);let e=t%8,i=Math.floor(t/8),s=String.fromCharCode(e+97),n=8-i;return s+n}testConverToBoardIndex(){let t=[];t.push(this.convertToBoardIndex("a8")==0),t.push(this.convertToBoardIndex("b8")==1),t.push(this.convertToBoardIndex("c8")==2),t.push(this.convertToBoardIndex("d8")==3),t.push(this.convertToBoardIndex("e8")==4),t.push(this.convertToBoardIndex("f8")==5),t.push(this.convertToBoardIndex("g8")==6),t.push(this.convertToBoardIndex("h8")==7),t.push(this.convertToBoardIndex("a7")==8),t.push(this.convertToBoardIndex("b7")==9),t.push(this.convertToBoardIndex("c7")==10),t.push(this.convertToBoardIndex("d7")==11),t.push(this.convertToBoardIndex("e7")==12),t.push(this.convertToBoardIndex("f7")==13),t.push(this.convertToBoardIndex("g7")==14),t.push(this.convertToBoardIndex("h7")==15),t.push(this.convertToBoardIndex("a6")==16);for(let e=0;e<t.length;e++)if(!t[e])throw new Error("Convert to board Index failed failed")}runAllTests(){this.testConverToBoardIndex(),console.log("All tests ran for move class")}}class Z{position;pos;boardIndex;constructor(t,e){t?(this.position=t,this.boardIndex=this.convertToBoardIndex(t),this.pos=new a(this.convertToBoardIndex(t)%8,Math.floor(this.convertToBoardIndex(t)/8))):e?(this.boardIndex=e,this.position=this.convertToBoardPosition(e),this.pos=new a(e%8,Math.floor(e/8))):(this.position="a8",this.boardIndex=0,this.pos=new a(0,0))}moveTo(t){this.position=t,this.boardIndex=this.convertToBoardIndex(t),this.pos=new a(this.boardIndex%8,Math.floor(this.boardIndex/8))}getPosition(){return this.position}getIndex(){return this.boardIndex}convertToBoardIndex(t){if(t.length!=2)throw new Error("Invalid position");let e=t[0],i=t[1],s=e.charCodeAt(0)-97,n=8-parseInt(i);return s+n*8}testConvertToBoardIndex(){let t=[];t.push(this.convertToBoardIndex("a8")==0),t.push(this.convertToBoardIndex("b8")==1),t.push(this.convertToBoardIndex("c8")==2),t.push(this.convertToBoardIndex("d8")==3),t.push(this.convertToBoardIndex("e8")==4),t.push(this.convertToBoardIndex("f8")==5),t.push(this.convertToBoardIndex("g8")==6),t.push(this.convertToBoardIndex("h8")==7),t.push(this.convertToBoardIndex("a7")==8),t.push(this.convertToBoardIndex("b7")==9),t.push(this.convertToBoardIndex("c7")==10),t.push(this.convertToBoardIndex("d7")==11),t.push(this.convertToBoardIndex("e7")==12),t.push(this.convertToBoardIndex("f7")==13),t.push(this.convertToBoardIndex("g7")==14),t.push(this.convertToBoardIndex("h7")==15),t.push(this.convertToBoardIndex("a6")==16);for(let e=0;e<t.length;e++)if(!t[e])throw new Error("Convert to board Index failed failed")}convertToBoardPosition(t){let e=t%8,i=Math.floor(t/8),s=String.fromCharCode(e+97),n=8-i;return s+n}testConvertToPosition(){let t=[];t.push(this.convertToBoardPosition(0)=="a8"),t.push(this.convertToBoardPosition(0)=="a8"),t.push(this.convertToBoardPosition(0)=="a8"),t.push(this.convertToBoardPosition(1)=="b8"),t.push(this.convertToBoardPosition(2)=="c8"),t.push(this.convertToBoardPosition(3)=="d8"),t.push(this.convertToBoardPosition(4)=="e8"),t.push(this.convertToBoardPosition(5)=="f8"),t.push(this.convertToBoardPosition(6)=="g8"),t.push(this.convertToBoardPosition(7)=="h8"),t.push(this.convertToBoardPosition(8)=="a7"),t.push(this.convertToBoardPosition(9)=="b7"),t.push(this.convertToBoardPosition(10)=="c7"),t.push(this.convertToBoardPosition(11)=="d7"),t.push(this.convertToBoardPosition(12)=="e7"),t.push(this.convertToBoardPosition(13)=="f7"),t.push(this.convertToBoardPosition(14)=="g7"),t.push(this.convertToBoardPosition(15)=="h7"),t.push(this.convertToBoardPosition(16)=="a6");for(let e=0;e<t.length;e++)if(!t[e])throw new Error("Convert to position failed")}runAllTests(){this.testConvertToBoardIndex(),this.testConvertToPosition(),console.log("All tests ran for position class")}}class T{position;color;type;constructor(t,e,i){this.position=new Z(t),this.color=e,this.type=i}move(t){this.position.moveTo(t)}getPosition(){return this.position.getPosition()}getIndex(){return this.position.getIndex()}getPos(){return this.position}convertToBoardIndex(t){if(t.length!=2)throw new Error("Invalid position");let e=t[0],i=t[1],s=e.charCodeAt(0)-97,n=8-parseInt(i);return s+n*8}testConverToBoardIndex(){let t=[];t.push(this.convertToBoardIndex("a8")==0),t.push(this.convertToBoardIndex("b8")==1),t.push(this.convertToBoardIndex("c8")==2),t.push(this.convertToBoardIndex("d8")==3),t.push(this.convertToBoardIndex("e8")==4),t.push(this.convertToBoardIndex("f8")==5),t.push(this.convertToBoardIndex("g8")==6),t.push(this.convertToBoardIndex("h8")==7),t.push(this.convertToBoardIndex("a7")==8),t.push(this.convertToBoardIndex("b7")==9),t.push(this.convertToBoardIndex("c7")==10),t.push(this.convertToBoardIndex("d7")==11),t.push(this.convertToBoardIndex("e7")==12),t.push(this.convertToBoardIndex("f7")==13),t.push(this.convertToBoardIndex("g7")==14),t.push(this.convertToBoardIndex("h7")==15),t.push(this.convertToBoardIndex("a6")==16);for(let e=0;e<t.length;e++)if(!t[e])throw new Error("Convert to board Index failed failed")}runAllTests(){this.testConverToBoardIndex(),console.log("All tests ran for piece class")}}class v{Pieces;currentTurnColor="white";fen="";board=[];halfMoveClock=0;fullMoveNumber=1;castlingRights="KQkq";enPassantTargetSquare="-";legalMoves=[];inCheck=!1;checkMate=!1;capturedPieces=[];constructor(t,e){t||(t=["r","n","b","q","k","b","n","r","p","p","p","p","p","p","p","p"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","P","P","P","P","P","P","P","P","R","N","B","Q","K","B","N","R"]);const i=/^([rnbqkpRNBQKP1-8]+\/){7}([rnbqkpRNBQKP1-8]+)\s[bw]\s(-|K?Q?k?q?)\s(-|[a-h][36])\s(0|[1-9][0-9]*)\s([1-9][0-9]*)/;if(e!=null&&e.match(i)){let s=e.split(" ");t=this.fenToBoard(e),this.castlingRights=s[2],this.enPassantTargetSquare=s[3],s[1]==="w"?this.currentTurnColor="white":this.currentTurnColor="black",this.halfMoveClock=parseInt(s[4]),this.fullMoveNumber=parseInt(s[5])}else if(e!=null&&!e.match(i))throw new Error("Invalid fen: "+e);this.Pieces=[];for(let s=0;s<t.length;s++){let n=t[s];if(n!=" "){let c=n==n.toUpperCase()?"white":"black",o=n.toLowerCase(),l=this.convertToPosition(s);this.Pieces.push(new T(l,c,o))}}this.board=t,e!=null?this.fen=e:this.fen=this.boardToFen()}convertToPosition(t){let e=String.fromCharCode(97+t%8),i=8-Math.floor(t/8);return e+i}displayBoard(){let t="";for(let e=0;e<8;e++){for(let i=0;i<8;i++)t+=this.Piece(new a(i,e))===" "?" - ":" "+this.Piece(new a(i,e)).type+" ";t!=null&&console.log(`${8-e}| `+t),t=""}console.log("    _  _  _  _  _  _  _  _"),console.log("    A  B  C  D  E  F  G  H")}fenToBoard(t){let e=[],n=t.split(" ")[0].split("/");for(let c=0;c<n.length;c++){let l=n[c].split("");for(let f=0;f<l.length;f++){let u=l[f];if(u.match(/[1-8]/))for(let d=0;d<parseInt(u);d++)e.push(" ");else e.push(u)}}return e.length===63&&e.push(" "),e}boardToFen(){let t="",e=0;for(let i=0;i<64;i++){let s=this.getPieceAtBoardIndex(i);s===""?(e++,(e===8||i%8===7)&&(t+=e,i!=63&&(t+="/"),e=0)):(e!==0&&(t+=e,e=0),t+=s.color==="white"?s.type.toUpperCase():s.type.toLowerCase(),s.getIndex()%8===7&&i!==63&&(t+="/",e=0))}return t+=" "+this.currentTurnColor[0]+" ",t+=this.castlingRights+" ",t+=this.enPassantTargetSquare+" ",t+=this.halfMoveClock+" ",t+=this.fullMoveNumber,t}getPieceAtBoardIndex(t){for(let e=0;e<this.Pieces.length;e++)if(this.Pieces[e].getIndex()===t)return this.Pieces[e];return""}movePiece(t,e){let i=new h(void 0,void 0,t,e);i.boardEndIndex;let s=this.getPieceIndex(t),n=this.Pieces[s];if(n?.type===void 0)throw this.displayBoard(),console.log(this.Pieces),console.log(this.fen),console.log(t),new Error("Invalid move");if(n.type!="p"?this.halfMoveClock++:this.halfMoveClock=0,this.enPassantTargetSquare!="-"&&n.type==="p"){let c=new Z(t),o=new Z(e);if(n.color==="white"&&c.pos.y===3&&o.position===e){let l=o.boardIndex+8,f=this.getPieceAtBoardIndex(l);this.board[l]=" ",this.Pieces.splice(this.Pieces.indexOf(f),1)}if(n.color==="black"&&c.pos.y===4&&o.position===e){let l=o.boardIndex-8,f=this.getPieceAtBoardIndex(l);this.board[l]=" ",this.Pieces.splice(this.Pieces.indexOf(f),1)}}if(n.type=="p"&&Math.abs(n.getIndex()-i.boardEndIndex)==16){let c="-";n.color==="white"?c=this.convertToPosition(i.boardEndIndex+8):c=this.convertToPosition(i.boardEndIndex-8),this.enPassantTargetSquare=c}else this.enPassantTargetSquare="-";if(n.type==="k"){this.castlingRights.length===2?this.castlingRights="-":n.color==="white"?this.castlingRights=this.castlingRights.replace("KQ",""):this.castlingRights=this.castlingRights.replace("kq","");let c=new Z(t),o=new Z(e);if(c.pos.x-o.pos.x===2){this.convertToPosition(c.boardIndex-4);let l=this.convertToPosition(c.boardIndex-1);this.getPieceAtBoardIndex(c.boardIndex-4).move(l)}if(c.pos.x-o.pos.x===-2){this.convertToPosition(c.boardIndex+3);let l=this.convertToPosition(c.boardIndex+1);this.getPieceAtBoardIndex(c.boardIndex+3).move(l)}}if(this.currentTurnColor==="black"&&this.fullMoveNumber++,n.type==="r"&&(n.color==="white"?n.getIndex()===0?this.castlingRights=this.castlingRights.replace("Q",""):n.getIndex()===7&&(this.castlingRights=this.castlingRights.replace("K","")):n.getIndex()===56?this.castlingRights=this.castlingRights.replace("q",""):n.getIndex()===63&&(this.castlingRights=this.castlingRights.replace("k",""))),this.getPieceIndex(e)!==-1){let c=this.getPieceIndex(e),o=this.Pieces[c];this.capturedPieces.push(o),this.Pieces.splice(c,1),this.halfMoveClock=0}n.move(e),this.currentTurnColor=this.currentTurnColor==="white"?"black":"white",this.fen=this.boardToFen(),this.board=this.fenToBoard(this.fen),this.inCheck=this.isInCheck(this)}getPieceIndex(t){let e=-1;for(let i=0;i<this.Pieces.length;i++)if(this.Pieces[i].getPosition()==t){e=i;break}return e}getPieceAtPosition(t){let e="";for(let i=0;i<this.Pieces.length;i++){let s=this.Pieces[i];if(s.getPosition()==t)return s}return e}testConvertToPosition(){let t=[];t.push(this.convertToPosition(0)=="a8"),t.push(this.convertToPosition(1)=="b8"),t.push(this.convertToPosition(2)=="c8"),t.push(this.convertToPosition(3)=="d8"),t.push(this.convertToPosition(4)=="e8"),t.push(this.convertToPosition(5)=="f8"),t.push(this.convertToPosition(6)=="g8"),t.push(this.convertToPosition(7)=="h8"),t.push(this.convertToPosition(8)=="a7"),t.push(this.convertToPosition(9)=="b7"),t.push(this.convertToPosition(10)=="c7"),t.push(this.convertToPosition(11)=="d7"),t.push(this.convertToPosition(12)=="e7"),t.push(this.convertToPosition(13)=="f7"),t.push(this.convertToPosition(14)=="g7"),t.push(this.convertToPosition(15)=="h7"),t.push(this.convertToPosition(16)=="a6");for(let e=0;e<t.length;e++)if(!t[e])throw new Error("Convert to position failed")}testFenToBoard(){let t=[];t.push(this.fenToBoard("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1")),t.push(this.fenToBoard("rnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR b KQkq e3 0 1"));for(let i=0;i<t.length;i++)if(!t[i])throw new Error("Fen to board failed");e(t[0],["r","n","b","q","k","b","n","r","p","p","p","p","p","p","p","p"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","P","P","P","P","P","P","P","P","R","N","B","Q","K","B","N","R"]),e(t[1],["r","n","b","q","k","b","n","r","p","p","p","p","p","p","p","p"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","P"," "," "," "," "," "," "," "," "," "," "," ","P","P","P","P"," ","P","P","P","R","N","B","Q","K","B","N","R"]);function e(i,s){if(i===s)return!0;if(i==null||s==null)throw console.log(i,s),new Error("Fen to board failed");if(i.length!==s.length)throw console.log(i,s),new Error("Fen to board failed");for(var n=0;n<i.length;++n)if(i[n]!==s[n])throw console.log(i,s),new Error("Fen to board failed");return!0}}testBoardToFen(){let t=[],e=new v;t.push(e.boardToFen()=="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"),e.movePiece("e2","e4"),t.push(e.boardToFen()=="rnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR b KQkq e3 0 1");for(let i=0;i<t.length;i++)if(!t[i])throw new Error("Board to fen failed, test "+(i+1)+" failed"+e.boardToFen())}testConstructors(){let t=new v,e=[];e.push(t.Pieces[0]?.getPosition()=="a8"),e.push(t.Pieces[0].color=="black"),e.push(t.Pieces[0].type=="r"),e.push(t.Pieces[1]?.getPosition()=="b8"),e.push(t.Pieces[1].color=="black"),e.push(t.Pieces[1].type=="n"),e.push(t.Pieces[2]?.getPosition()=="c8"),e.push(t.Pieces[2].color=="black"),e.push(t.Pieces[2].type=="b"),e.push(t.Pieces[3]?.getPosition()=="d8");for(let n=0;n<e.length;n++)if(!e[n])throw new Error("Board constructor 1 failed "+n);let i=new v([],"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1");e=[],e.push(i.Pieces[0]?.getPosition()=="a8"),e.push(i.Pieces[0].color=="black"),e.push(i.Pieces[0].type=="r"),e.push(i.Pieces[1]?.getPosition()=="b8"),e.push(i.Pieces[1].color=="black"),e.push(i.Pieces[1].type=="n"),e.push(i.Pieces[2]?.getPosition()=="c8"),e.push(i.Pieces[2].color=="black"),e.push(i.Pieces[2].type=="b"),e.push(i.Pieces[3]?.getPosition()=="d8");for(let n=0;n<e.length;n++)if(!e[n])throw new Error("Board constructor 2 failed"+n);let s=new v([],"rnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR b KQkq e3 0 1");e=[],e.push(s.Pieces[0]?.getPosition()=="a8"),e.push(s.Pieces[0].color=="black"),e.push(s.Pieces[0].type=="r"),e.push(s.currentTurnColor=="black");for(let n=0;n<e.length;n++)if(!e[n])throw new Error("Board constructor 3 failed"+n)}findPseudoLegalMoves(t){let e=[];for(let i=0;i<t.Pieces.length;i++){let s=t.Pieces[i];if(t.currentTurnColor===s.color)switch(s.type){case"p":e.push(...this.findPawnMoves(s,t));break;case"r":e.push(...this.findRookMoves(s,t));break;case"n":e.push(...this.findKnightMoves(s,t));break;case"b":e.push(...this.findBishopMoves(s,t));break;case"q":e.push(...this.findQueenMoves(s,t));break;case"k":e.push(...this.findKingMoves(s,t));break}}return e}testFindPseudoLegalMoves(){let t=new v,e=this.findPseudoLegalMoves(t),i=[];i.push(e.length==20);for(let s=0;s<i.length;s++)if(!i[s])throw new Error("Find legal moves failed, test "+(s+1)+" failed");t=new v([],"rnbqkbnr/1ppp1ppp/8/p3pP2/4P3/8/PPPP2PP/RNBQKBNR w KQkq e6 0 4"),e=this.findPseudoLegalMoves(t),i=[],i.push(e.length==30);for(let s=0;s<i.length;s++)if(!i[s])throw new Error("Find legal moves failed, test "+(s+1)+" failed")}findLegalMoves(t){let e=t.findPseudoLegalMoves(t),i=[];for(let s=0;s<e.length;s++){let n=new v([],t.boardToFen());n.movePiece(e[s].start,e[s].end),n.currentTurnColor=n.currentTurnColor==="white"?"black":"white",this.isInCheck(n)||i.push(e[s])}return i}testFindLegalMoves(){let t=new v,e=this.findLegalMoves(t),i=[];i.push(e.length==20),t=new v([],"rnb1k1nr/pppp1ppp/8/2b1p3/P3q3/8/1PPP1PPP/RNBQKB1R w KQkq - 0 6"),e=this.findLegalMoves(t),i.push(e.length==2),t=new v([],"rnbqkbnr/1ppp1ppp/8/p3Q3/4P3/8/PPPP1PPP/RNB1KBNR b KQkq - 0 3"),e=this.findLegalMoves(t),i.push(e.length==3),t=new v([],"rnbqkbnr/p1p1pppp/1p6/3pP3/8/8/PPPP1PPP/RNBQKBNR w KQkq d6 0 3"),e=this.findLegalMoves(t),i.push(e.length==31);for(let s=0;s<i.length;s++)if(!i[s])throw new Error("Find legal moves failed, test "+(s+1)+" failed")}isInCheck(t){let e=new v([],t.boardToFen()),i=!0;for(let c=0;c<e.board.length;c++)e.board[c]!="-"&&(i=!1);i&&(console.log("empty board"),console.log(t.boardToFen())),e.currentTurnColor=e.currentTurnColor=="white"?"black":"white";let s=t.findPseudoLegalMoves(e),n;for(let c=0;c<t.Pieces.length;c++)t.Pieces[c].type=="k"&&t.Pieces[c].color==t.currentTurnColor&&(n=t.Pieces[c].getIndex());s.length==0&&(console.log("main board"),t.displayBoard(),console.log(t.fen),console.log("thingy"),e.displayBoard(),console.log(e.fen));for(let c=0;c<s.length;c++)if(s[c].boardEndIndex==n)return!0;return!1}testIsInCheck(){let t=new v,e=[];e.push(!this.isInCheck(t));for(let i=0;i<e.length;i++)if(!e[i])throw new Error("Is in check failed, test "+(i+1)+" failed")}Piece(t){let e=t.x+t.y*8;for(let i=0;i<this.Pieces.length;i++)if(this.Pieces[i].getIndex()==e)return this.Pieces[i];return" "}addPiece(t){this.Pieces.push(t),this.board[t.getIndex()]!=null&&this.board[t.getIndex()]!=" "&&console.log("ERROR: PIECE ALREADY EXISTS AT THIS LOCATION",t),this.board[t.getIndex()]=t.type}findPawnMoves(t,e){let i=[],s=t.getIndex(),n=new a(s%8,Math.floor(s/8)),c=t.color;if(c!=this.currentTurnColor)return i;if(c=="white"){let o=new a(n.x,n.y-1);e.Piece(o)==" "&&i.push(new h(n,o));let l=new a(n.x,n.y-2);e.Piece(l)==" "&&e.Piece(o)==" "&&n.y==6&&i.push(new h(n,l));let f=new a(n.x-1,n.y-1);e.Piece(f)!=" "&&e.Piece(f)?.color=="black"&&i.push(new h(n,f));let u=new a(n.x+1,n.y-1);if(e.Piece(u)!=" "&&e.Piece(u)?.color=="black"&&i.push(new h(n,u)),e.enPassantTargetSquare!="-"&&s<=31&&s>=24){let d=new a(e.enPassantTargetSquare.charCodeAt(0)-97,8-parseInt(e.enPassantTargetSquare[1]));be(d,u)===!0&&i.push(new h(n,u)),be(d,f)===!0&&i.push(new h(n,f))}}else{let o=new a(n.x,n.y+1);e.Piece(o)==" "&&i.push(new h(n,o));let l=new a(n.x,n.y+2);e.Piece(l)==" "&&e.Piece(o)==" "&&n.y==1&&i.push(new h(n,l));let f=new a(n.x-1,n.y+1);e.Piece(f)!=" "&&e.Piece(f)?.color=="white"&&i.push(new h(n,f));let u=new a(n.x+1,n.y+1);if(e.Piece(u)!=" "&&e.Piece(u)?.color=="white"&&i.push(new h(n,u)),e.enPassantTargetSquare!="-"&&s<=15&&s>=8){let d=new a(e.enPassantTargetSquare.charCodeAt(0)-97,8-parseInt(e.enPassantTargetSquare[1]));u==d&&i.push(new h(n,u)),f==d&&i.push(new h(n,f))}}return i}testFindPawnMoves(){let t=new v,e=this.findPawnMoves(t.Piece(new a(0,6)),t),i=[];i.push(e.length==2),i.push(e[0].toString()=="a2-a3"),i.push(e[1].toString()=="a2-a4");for(let n=0;n<i.length;n++)if(i[n]==!1){console.log("testFindPawnMoves failed");return}i=[],e=this.findPawnMoves(t.Pieces[16],t),i.push(e.length==2),i.push(e[0].toString()=="a2-a3"),i.push(e[1].toString()=="a2-a4");for(let n=0;n<i.length;n++)if(i[n]==!1){console.log("testFindPawnMoves failed");return}t=new v([]);let s=new T("a5","black",qe);t.addPiece(s),s=new T("a4","white",qe),t.addPiece(s),e=this.findPawnMoves(s,t),i=[],i.push(e.length==0);for(let n=0;n<i.length;n++)if(i[n]==!1){console.error("testFindPawnMoves failed");return}}findRookMoves(t,e){let i=[],s=t.getIndex(),n=new a(s%8,Math.floor(s/8)),c=t.color;if(c!=e.currentTurnColor)return i;if(c==="white"){for(let o=n.y-1;o>=0;o--){let l=new a(n.x,o);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="black"){i.push(new h(n,l));break}else break}for(let o=n.y+1;o<=7;o++){let l=new a(n.x,o);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="black"){i.push(new h(n,l));break}else break}for(let o=n.x-1;o>=0;o--){let l=new a(o,n.y);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="black"){i.push(new h(n,l));break}else break}for(let o=n.x+1;o<=7;o++){let l=new a(o,n.y);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="black"){i.push(new h(n,l));break}else break}}else{for(let o=n.y-1;o>=0;o--){let l=new a(n.x,o);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="white"){i.push(new h(n,l));break}else break}for(let o=n.y+1;o<=7;o++){let l=new a(n.x,o);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="white"){i.push(new h(n,l));break}else break}for(let o=n.x-1;o>=0;o--){let l=new a(o,n.y);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="white"){i.push(new h(n,l));break}else break}for(let o=n.x+1;o<=7;o++){let l=new a(o,n.y);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="white"){i.push(new h(n,l));break}else break}}return i}testFindRookMoves(){let t=new v([],"rnbqkbnr/1ppppppp/8/p7/P7/8/1PPPPPPP/RNBQKBNR w KQkq a6 0 2"),e=t.findRookMoves(t.Piece(new a(0,7)),t),i=[];i.push(e.length===2);for(let s=0;s<i.length;s++)if(i[s]==!1){console.log("testFindRookMoves failed");return}}findKnightMoves(t,e){let i=[],s=t.getIndex(),n=new a(s%8,Math.floor(s/8)),c=t.color;if(c!=e.currentTurnColor)return i;if(c==="white"){if(n.x-2>=0&&n.y-1>=0){let o=new a(n.x-2,n.y-1);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="black"&&i.push(new h(n,o))}if(n.x+2<=7&&n.y-1>=0){let o=new a(n.x+2,n.y-1);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="black"&&i.push(new h(n,o))}if(n.x-2>=0&&n.y+1<=7){let o=new a(n.x-2,n.y+1);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="black"&&i.push(new h(n,o))}if(n.x+2<=7&&n.y+1<=7){let o=new a(n.x+2,n.y+1);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="black"&&i.push(new h(n,o))}if(n.x-1>=0&&n.y-2>=0){let o=new a(n.x-1,n.y-2);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="black"&&i.push(new h(n,o))}if(n.x-1>=0&&n.y+2<=7){let o=new a(n.x-1,n.y+2);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="black"&&i.push(new h(n,o))}if(n.x+1<=7&&n.y-2>=0){let o=new a(n.x+1,n.y-2);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="black"&&i.push(new h(n,o))}if(n.x+1<=7&&n.y+2<=7){let o=new a(n.x+1,n.y+2);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="black"&&i.push(new h(n,o))}}else{if(n.x-2>=0&&n.y-1>=0){let o=new a(n.x-2,n.y-1);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="white"&&i.push(new h(n,o))}if(n.x+2<=7&&n.y-1>=0){let o=new a(n.x+2,n.y-1);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="white"&&i.push(new h(n,o))}if(n.x-2>=0&&n.y+1<=7){let o=new a(n.x-2,n.y+1);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="white"&&i.push(new h(n,o))}if(n.x+2<=7&&n.y+1<=7){let o=new a(n.x+2,n.y+1);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="white"&&i.push(new h(n,o))}if(n.x-1>=0&&n.y-2>=0){let o=new a(n.x-1,n.y-2);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="white"&&i.push(new h(n,o))}if(n.x-1>=0&&n.y+2<=7){let o=new a(n.x-1,n.y+2);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="white"&&i.push(new h(n,o))}if(n.x+1<=7&&n.y-2>=0){let o=new a(n.x+1,n.y-2);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="white"&&i.push(new h(n,o))}if(n.x+1<=7&&n.y+2<=7){let o=new a(n.x+1,n.y+2);e.Piece(o)===" "?i.push(new h(n,o)):e.Piece(o)?.color==="white"&&i.push(new h(n,o))}}return i}testFindKnightMoves(){let t=new v([]),e=[];t.currentTurnColor="white";let i=new T("c3","white",ye);t.addPiece(i);let s=t.findKnightMoves(i,t);e.push(s.length===8),t=new v([]),i=new T("c3","black",ye),t.addPiece(i),t.currentTurnColor="black",s=t.findKnightMoves(i,t),e.push(s.length===8),t=new v([]),i=new T("a1","white",ye),t.addPiece(i),s=t.findKnightMoves(i,t),e.push(s.length===2);for(let n=0;n<e.length;n++)if(!e[n]){console.log("testFindKnightMoves failed at test "+n);return}}findBishopMoves(t,e){let i=[],s=t.getIndex(),n=new a(s%8,Math.floor(s/8)),c=t.color;if(c!=e.currentTurnColor)return i;if(c==="white"){for(let o=1;o<=7&&!(n.x-o<0||n.y-o<0);o++){let l=new a(n.x-o,n.y-o);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="black"){i.push(new h(n,l));break}else break}for(let o=1;o<=7&&!(n.x+o>7||n.y-o<0);o++){let l=new a(n.x+o,n.y-o);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="black"){i.push(new h(n,l));break}else break}for(let o=1;o<=7&&!(n.x-o<0||n.y+o>7);o++){let l=new a(n.x-o,n.y+o);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="black"){i.push(new h(n,l));break}else break}for(let o=1;o<=7&&!(n.x+o>7||n.y+o>7);o++){let l=new a(n.x+o,n.y+o);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="black"){i.push(new h(n,l));break}else break}}else{for(let o=1;o<=7&&!(n.x-o<0||n.y+o>7);o++){let l=new a(n.x-o,n.y+o);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="white"){i.push(new h(n,l));break}else break}for(let o=1;o<=7&&!(n.x+o>7||n.y+o>7);o++){let l=new a(n.x+o,n.y+o);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="white"){i.push(new h(n,l));break}else break}for(let o=1;o<=7&&!(n.x-o<0||n.y-o<0);o++){let l=new a(n.x-o,n.y-o);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="white"){i.push(new h(n,l));break}else break}for(let o=1;o<=7&&!(n.x+o>7||n.y-o<0);o++){let l=new a(n.x+o,n.y-o);if(e.Piece(l)===" ")i.push(new h(n,l));else if(e.Piece(l)?.color==="white"){i.push(new h(n,l));break}else break}}return i}testFindBishopMoves(){let t=new v([]),e=new T("a2","white",W);t.addPiece(e);let i=t.findBishopMoves(e,t);if(i.length!==7){console.log("testFindBishopMoves failed 0");return}if(t=new v([]),e=new T("a2","black",W),t.addPiece(e),t.currentTurnColor="black",i=t.findBishopMoves(e,t),i.length!==7){console.log("testFindBishopMoves failed 1");return}if(t=new v([]),e=new T("a2","white",W),t.addPiece(e),t.currentTurnColor="black",e=new T("b3","black",W),t.addPiece(e),i=t.findBishopMoves(e,t),i.length!==9){console.log("testFindBishopMoves failed 2");return}if(t=new v([]),e=new T("a2","black",W),t.addPiece(e),e=new T("b3","white",W),t.addPiece(e),i=t.findBishopMoves(e,t),i.length!==9){console.log("testFindBishopMoves failed 3");return}}findQueenMoves(t,e){let i=this.findRookMoves(t,e);return i.push(...this.findBishopMoves(t,e)),i}testFindQueenMoves(){let t=new v([]),e=new T("a2","white",J);t.addPiece(e);let i=t.findQueenMoves(e,t);if(i.length!==21){console.log(i),console.error("testFindQueenMoves failed 0");return}if(t=new v([]),e=new T("a2","black",J),t.addPiece(e),t.currentTurnColor="black",i=t.findQueenMoves(e,t),i.length!==21){t.displayBoard(),console.log(i),console.error("testFindQueenMoves failed 1");return}if(t=new v([]),e=new T("a2","white",J),t.addPiece(e),t.currentTurnColor="black",e=new T("b3","black",J),t.addPiece(e),i=t.findQueenMoves(e,t),i.length!==23){console.error("testFindQueenMoves failed 2");return}if(t=new v([]),e=new T("a2","black",J),t.addPiece(e),e=new T("b3","white",J),t.addPiece(e),i=t.findQueenMoves(e,t),i.length!==23){console.error("testFindQueenMoves failed 3");return}}findKingMoves(t,e){let i=[],s=t.getPos().pos,n=new a(s.x,s.y+1);return t.color==="black"?(e.Piece(n)===" "&&s.y+1<=7?i.push(new h(s,n)):e.Piece(n)?.color==="white"&&i.push(new h(s,n)),n=new a(s.x,s.y-1),e.Piece(n)===" "&&s.y-1>=0?i.push(new h(s,n)):e.Piece(n)?.color==="white"&&i.push(new h(s,n)),n=new a(s.x+1,s.y),e.Piece(n)===" "&&s.x+1<=7?i.push(new h(s,n)):e.Piece(n)?.color==="white"&&i.push(new h(s,n)),n=new a(s.x-1,s.y),e.Piece(n)===" "&&s.x-1>=0?i.push(new h(s,n)):e.Piece(n)?.color==="white"&&i.push(new h(s,n)),n=new a(s.x+1,s.y+1),e.Piece(n)===" "&&s.x+1<=7&&s.y+1<=7?i.push(new h(s,n)):e.Piece(n)?.color==="white"&&i.push(new h(s,n)),n=new a(s.x-1,s.y+1),e.Piece(n)===" "&&s.x-1>=0&&s.y+1<=7?i.push(new h(s,n)):e.Piece(n)?.color==="white"&&i.push(new h(s,n)),n=new a(s.x+1,s.y-1),e.Piece(n)===" "&&s.x+1<=7&&s.y-1>=0?i.push(new h(s,n)):e.Piece(n)?.color==="white"&&i.push(new h(s,n)),n=new a(s.x-1,s.y-1),e.Piece(n)===" "&&s.x-1>=0&&s.y-1>=0?i.push(new h(s,n)):e.Piece(n)?.color==="white"&&i.push(new h(s,n)),n=new a(s.x+2,s.y),e.Piece(n)===" "&&s.x+2===6&&s.y===0&&this.inCheck===!1&&e.Piece(new a(s.x+1,s.y))===" "&&e.castlingRights.includes("k")&&i.push(new h(s,n)),n=new a(s.x-2,s.y),e.Piece(n)===" "&&s.x-2===2&&s.y===0&&this.inCheck===!1&&e.Piece(new a(s.x-1,s.y))===" "&&e.Piece(n)===" "&&e.castlingRights.includes("q")&&i.push(new h(s,n))):(n=new a(s.x,s.y+1),e.Piece(n)===" "&&s.y+1<=7?i.push(new h(s,n)):e.Piece(n)?.color==="black"&&i.push(new h(s,n)),n=new a(s.x,s.y-1),e.Piece(n)===" "&&s.y-1>=0?i.push(new h(s,n)):e.Piece(n)?.color==="black"&&i.push(new h(s,n)),n=new a(s.x+1,s.y),e.Piece(n)===" "&&s.x+1<=7?i.push(new h(s,n)):e.Piece(n)?.color==="black"&&i.push(new h(s,n)),n=new a(s.x-1,s.y),e.Piece(n)===" "&&s.x-1>=0?i.push(new h(s,n)):e.Piece(n)?.color==="black"&&i.push(new h(s,n)),n=new a(s.x+1,s.y+1),e.Piece(n)===" "&&s.x+1<=7&&s.y+1<=7?i.push(new h(s,n)):e.Piece(n)?.color==="black"&&i.push(new h(s,n)),n=new a(s.x-1,s.y+1),e.Piece(n)===" "&&s.x-1>=0&&s.y+1<=7?i.push(new h(s,n)):e.Piece(n)?.color==="black"&&i.push(new h(s,n)),n=new a(s.x+1,s.y-1),e.Piece(n)===" "&&s.x+1<=7&&s.y-1>=0?i.push(new h(s,n)):e.Piece(n)?.color==="black"&&i.push(new h(s,n)),n=new a(s.x-1,s.y-1),e.Piece(n)===" "&&s.x-1>=0&&s.y-1>=0?i.push(new h(s,n)):e.Piece(n)?.color==="black"&&i.push(new h(s,n)),n=new a(s.x+2,s.y),e.Piece(n)===" "&&s.x+2===6&&s.y===7&&this.inCheck===!1&&e.Piece(new a(s.x+1,s.y))===" "&&e.castlingRights.includes("K")&&i.push(new h(s,n)),n=new a(s.x-2,s.y),e.Piece(n)===" "&&s.x-2===2&&s.y===7&&this.inCheck===!1&&e.Piece(new a(s.x-1,s.y))===" "&&e.Piece(n)===" "&&e.castlingRights.includes("Q")&&i.push(new h(s,n))),i}testFindKingMoves(){let t=new v([]),e=new T("a2","white",_);t.addPiece(e);let i=t.findKingMoves(e,t);if(i.length!==5){console.error("testFindKingMoves failed 0",i);return}if(t=new v([]),e=new T("a2","black",_),t.addPiece(e),t.currentTurnColor="black",i=t.findKingMoves(e,t),i.length!==5){console.error("testFindKingMoves failed 1");return}if(t=new v([]),e=new T("a2","white",_),t.addPiece(e),t.currentTurnColor="black",e=new T("b3","black",_),t.addPiece(e),i=t.findKingMoves(e,t),i.length!==8){console.error("testFindKingMoves failed 2");return}if(t=new v([]),e=new T("a2","black",_),t.addPiece(e),e=new T("b3","white",_),t.addPiece(e),i=t.findKingMoves(e,t),i.length!==8){console.error("testFindKingMoves failed 3");return}}runAllTests(){this.testConvertToPosition(),this.testConstructors(),this.testBoardToFen(),this.testFenToBoard(),this.testFindPawnMoves(),this.testFindRookMoves(),this.testFindKnightMoves(),this.testFindBishopMoves(),this.testFindQueenMoves(),this.testFindKingMoves(),this.testFindPseudoLegalMoves(),this.testIsInCheck(),this.testFindLegalMoves(),console.log("All tests ran for board class")}}class Xe{runAllTests(){new h(void 0,void 0,"a2","a4").runAllTests(),new Z("a2").runAllTests(),new T("a2","white","pawn").runAllTests(),new v().runAllTests(),console.log("All tests ran for chessClasses.ts")}}function be(r,t){return r&&t&&typeof r=="object"&&typeof t=="object"?Object.keys(r).length===Object.keys(t).length&&Object.keys(r).reduce(function(e,i){return e&&be(r[i],t[i])},!0):r===t}const Ge=rt();function Ve(r){M(0),M("Home");const[t,e]=M({x:0,y:0}),[i,s]=M({x:0,y:0}),[n,c]=M([]),[o,l]=M(!1),[f,u]=M(null),[d,P]=M(null),[g,B]=M({x:0,y:0}),[b,N]=M(null),[L,q]=M(null),y=[],C=[];xe(()=>{document.addEventListener("pointermove",w=>{e({x:w.clientX,y:w.clientY}),o()&&f()&&(f().ref.style.transform=`translate(${t().x-i().x+g().x}px, ${t().y-i().y+g().y}px)`,f().ref.style.zIndex=100,f().rectangle=f().ref.getBoundingClientRect(),b()?.length>0&&q(ze(b())))}),document.addEventListener("pointerup",()=>{f()!=null&&(f().dragEnd(L()),C.forEach(w=>{w()}),f()?.ref&&(f().ref.style.transform=`translate(${0}px, ${0}px)`,f().ref.style.zIndex=0),l(!1),P(f()),u(null))})});const E=(w,p)=>{p!==void 0&&p.dragStart.push(w)},k=w=>{y.push(w)},x=w=>{C.push(w)},m=(w,p)=>{p!==void 0&&(p.dragEnd=w)},Q=(w,p)=>{p!==void 0&&(p.hoverOver=w)},se=(w,p)=>{p!==void 0&&(p.hoverOut=w)},O=w=>{let p={id:w,startingPosition:{x:0,y:0},dragStart:[],dragEnd:()=>{},ref:null,rectangle:null,data:{}};return xe(()=>{p.ref.addEventListener("pointerdown",K=>{for(let F=0;F<p.dragStart.length;F++)p.dragStart[F](p);for(let F=0;F<y.length;F++)y[F](p);B(_e(K.target.getAttribute("style"))),s({x:K.clientX,y:K.clientY}),l(!0),u(p),p.rectangle=p.ref.getBoundingClientRect()})}),p},We=w=>{let p={id:w,startingPosition:{x:0,y:0},hoverOver:()=>{},hoverOut:()=>{},ref:null,rectangle:null,hovering:!1,occupied:!1,droppable:!0};return c([...n(),p]),xe(()=>{p.rectangle=p.ref.getBoundingClientRect(),p.ref.children.length>0&&(p.occupied=!0),document.addEventListener("pointermove",()=>{if(f()==null||f().rectangle==null)return;let K=f().ref.getBoundingClientRect(),F=p.ref.getBoundingClientRect();if(K.top>F.bottom||K.right<F.left||K.bottom<F.top||K.left>F.right){if(Ze(p),!p.hovering)return;p.hovering=!1,p.hoverOut(f())}else{if(p.ref===L()?.ref){if(p.hovering)return;p.hovering=!0,p.hoverOver(f())}else p.hovering=!1,p.hoverOut(f());Je(p)}}),document.addEventListener("pointerup",()=>{!p.hovering||(p.hovering=!1,p.hoverOut(d()),d()!=null&&p.droppable!==!1&&(p.ref.children.length>0&&p.ref.children[0].remove(),p.ref.appendChild(d().ref)))})}),n()[n().length-1]};function _e(w){if(w===null)return{x:0,y:0};let p=w.split("translate(")[0],K;return p&&(K=w.split("translate(")[1].split(")")[0].split("px, ")),{x:parseInt(K[0]),y:parseInt(K[1])}}function Je(w){b()==null&&N([w]),!b().includes(w)&&(b()?.includes(w)||N([...b(),w]))}function Ze(w){b()!=null&&(!b()?.includes(w)||b().includes(w)&&N(b()?.filter(p=>p!==w)))}function ze(w){if(w==null)return;let p=f().ref.getBoundingClientRect();return w.sort((F,et)=>{let G=F.ref.getBoundingClientRect(),V=et.ref.getBoundingClientRect(),ge,Pe,we,ve,Be,Ce;return p.x>G.x?ge=G.right-p.x:ge=p.right-G.x,p.bottom>G.bottom?Pe=G.bottom-p.top:Pe=p.bottom-G.top,Be=ge*Pe,p.x>V.x?we=V.right-p.x:we=p.right-V.x,p.bottom>V.bottom?ve=V.bottom-p.top:ve=p.bottom-V.top,Ce=we*ve,Ce-Be})[0]}return R(Ge.Provider,{value:{onDragEnd:m,onDragStart:E,createDraggable:O,onHoverOver:Q,createDroppable:We,onHoverOut:se,onGlobalDragStart:k,onGlobalDragEnd:x},get children(){return r.children}})}const $e=()=>lt(Ge),xt=ee("<div></div>"),yt=ee('<section><div class=""> </div></section>');function Ye({pieceClassName:r,className:t,id:e,board:i,draggableId:s,updateBoard:n,eatenPieces:c,setDisplayInlay:o,setDisplayInlayX:l,inlaySelection:f,displayInlay:u}){const d=({id:B,className:b,draggable:N,draggableClass:L})=>{const{onHoverOver:q,createDroppable:y,onHoverOut:C,onGlobalDragStart:E,onGlobalDragEnd:k}=$e(),x=y(B);return q(m=>{x.ref.classList.add("hovered")},x),C(m=>{x.ref.classList.remove("hovered")},x),E(m=>{if(!u())if(m.data.legalPieceMoves.includes(x.id))if(x.ref.children.length===0){x.droppable=!0;let Q=document.createElement("section");Q.classList.add("circle"),x.ref.appendChild(Q)}else x.ref.children.length===1&&(x.droppable=!0,x.ref.children[0].children[0].classList.add("circle"));else x.droppable=!1}),k(m=>{let Q=x.ref.querySelectorAll("section.circle");for(let O=0;O<Q.length;O++)Q[O].remove();let se=x.ref.querySelectorAll("div.circle");for(let O=0;O<se.length;O++)se[O].classList.remove("circle")}),N.getAttribute("class").length===0&&(N=void 0),(()=>{const m=xt.cloneNode(!0),Q=x.ref;return typeof Q=="function"?Ee(Q,m):x.ref=m,Ae(m,"id",B),ue(m,b),pe(m,R(de,{when:N!=null,children:N})),m})()},P=({className:B,id:b})=>{const{onDragStart:N,onDragEnd:L,createDraggable:q}=$e(),y=q(b);let C,E;return N(()=>{if(u())return;C=y.ref.parentElement.id;let k=i.findLegalMoves(i),x=[];for(let m=0;m<k.length;m++)k[m].start==C&&x.push(k[m].end);y.data.legalPieceMoves=x},y),L(async k=>{if(u()||k===null)return;k.occupied=!1;let x=k.ref.children[0];if(await g(1),!!k.ref.children[0]&&k.ref.children[0].id===y.id){if(E=y.ref.parentElement.id,E===C)return;i.board,i.movePiece(C,E),x.classList.contains("piece")&&(c.push(x),console.log(c)),i.board,console.log(i.inCheck);let m=i.getPieceAtPosition(E);m.type==="p"&&(m.color==="white"?E[1]==="8"&&(o(!0),l(m.position.pos.x)):E[1]==="1"&&(o(!0),l(m.position.pos.x))),n(),i.displayBoard()}},y),(()=>{const k=yt.cloneNode(!0),x=y.ref;return typeof x=="function"?Ee(x,k):y.ref=k,ue(k,B),Ae(k,"id",b),k})()},g=B=>new Promise(b=>setTimeout(b,B));return R(d,{className:t,get draggable(){return R(P,{className:`${r!=" "?r+" piece":""}`,id:s})},id:e})}const Tt=ee('<div><div class="chessInlaySquare" id="queenSelection"><section class="piece Q"></section></div><div class="chessInlaySquare" id="knightSelection"><section class="piece N"></section></div><div class="chessInlaySquare" id="rookSelection"><section class="piece R"></section></div><div class="chessInlaySquare" id="bishopSelection"><section class="piece B"></section></div></div>'),It=ee('<div class="chessBoard"></div>');let bt=new Xe;bt.runAllTests();let I=new v;I.displayBoard();let mt=kt();function kt(){let r=[];for(let t=0;t<8;t++)for(let e=0;e<8;e++)r.push(`${String.fromCharCode(97+e)}${8-t}`);return r}function Bt({}){let r=[];const[t,e]=M(!1),[i,s]=M("00"),[n,c]=M("");function o(){let f=document.querySelectorAll(".chessSquare"),u=[];for(let g=0;g<f.length;g++)f[g].children[0]!=null?u.push(f[g].children[0].classList[0]):u.push(" ");let d,P;for(let g=0;g<64;g++)u[g]!=I.board[g]&&(u[g]==" "&&I.board[g]!=" "?(P=f[g],d!=null&&(f[g].appendChild(d),d=void 0)):u[g]!=" "&&I.board[g]==" "&&(d=f[g].children[0],P!=null&&(P.appendChild(d),d=void 0,P=void 0)));d?.parentElement?.removeChild(d)}i()+"";function l(f){c(f),e(!1);let u=I.getPieceAtBoardIndex(parseInt(i())),d=u.type;u.type=f,I.board[parseInt(i())]=f,I.displayBoard(),console.log(u);let P=document.getElementById(u.position.position)?.children[0];console.log("previous type:"+d),P?.classList.remove(d.toUpperCase()),P?.classList.add(f.toUpperCase()),o()}return(()=>{const f=It.cloneNode(!0);return pe(f,R(Ve,{get children(){return[R(de,{get when(){return t()},get children(){const u=Tt.cloneNode(!0),d=u.firstChild,P=d.nextSibling,g=P.nextSibling,B=g.nextSibling;return d.$$click=()=>l("q"),P.$$click=()=>l("n"),g.$$click=()=>l("r"),B.$$click=()=>l("b"),z(()=>ue(u,`chessInlay ml-[${i()}]`)),u}}),R(je,{get each(){return I.board},children:(u,d)=>R(Ye,{get pieceClassName(){return I.board[d()]},get className(){return`chessSquare ${d()%16<8?d()%2==0?"lighterBackground":"":d()%2==0?"":"lighterBackground"}`},get id(){return mt[d()]},board:I,updateBoard:o,get draggableId(){return Ct()},eatenPieces:r,setDisplayInlay:e,setDisplayInlayX:s,inlaySelection:n,displayInlay:t})})]}})),f})()}function Ct(){return Math.random().toString(36).substr(2,9)}He(["click"]);const St=ee('<div><div class="chessInlaySquare" id="queenSelection"><section class="piece q"></section></div><div class="chessInlaySquare" id="knightSelection"><section class="piece n"></section></div><div class="chessInlaySquare" id="rookSelection"><section class="piece r"></section></div><div class="chessInlaySquare" id="bishopSelection"><section class="piece b"></section></div></div>'),Mt=ee('<div class="chessBoard"></div>');let At=new Xe;At.runAllTests();I.displayBoard();let Et=Rt();function Rt(){let r=[];for(let t=0;t<8;t++)for(let e=0;e<8;e++)r.push(`${String.fromCharCode(97+e)}${8-t}`);return r}function qt(r){let t=[];for(let e=r.length-1;e>=0;e--)t.push(r[e]);return t}function $t({}){let r=[];const[t,e]=M(!1),[i,s]=M(0),[n,c]=M("");function o(){let f=document.querySelectorAll(".chessSquare"),u=[];f=qt(f);for(let g=0;g<f.length;g++)f[g].children[0]!=null?u.push(f[g].children[0].classList[0]):u.push(" ");let d,P;for(let g=0;g<64;g++)u[g]!=I.board[g]&&(u[g]==" "&&I.board[g]!=" "?(P=f[g],d!=null&&(f[g].appendChild(d),d=void 0)):u[g]!=" "&&I.board[g]==" "&&(d=f[g].children[0],P!=null&&(P.appendChild(d),d=void 0,P=void 0)));d?.parentElement?.removeChild(d)}function l(f){c(f),e(!1);let u=I.getPieceAtBoardIndex(63-(7-i())),d=u.type;console.log(u),u.type=f,I.board[63-(7-i())]=f,I.displayBoard(),console.log(u);let P=document.getElementById(u.position.position).children[0];console.log("previous type:"+d),P.classList.remove(d),P.classList.add(f),o()}return(()=>{const f=Mt.cloneNode(!0);return pe(f,R(Ve,{get children(){return[R(de,{get when(){return t()},get children(){const u=St.cloneNode(!0),d=u.firstChild,P=d.nextSibling,g=P.nextSibling,B=g.nextSibling;return d.$$click=()=>l("q"),P.$$click=()=>l("n"),g.$$click=()=>l("r"),B.$$click=()=>l("b"),z(()=>ue(u,`chessInlay ml-[${7-i()}]`)),u}}),R(je,{get each(){return I.board},children:(u,d)=>R(Ye,{get pieceClassName(){return I.board[I.board.length-1-d()]},get className(){return`chessSquare ${(I.board.length-1-d())%16<8?(I.board.length-1-d())%2==0?"lighterBackground":"":(I.board.length-1-d())%2==0?"":"lighterBackground"}`},get id(){return Et[I.board.length-1-d()]},board:I,updateBoard:o,get draggableId(){return Nt()},eatenPieces:r,setDisplayInlay:e,setDisplayInlayX:s,inlaySelection:n,displayInlay:t})})]}})),f})()}function Nt(){return Math.random().toString(36).substr(2,9)}He(["click"]);function Ft({}){return[R(de,{when:!1,get children(){return R(Bt,{})}}),R($t,{})]}const Kt=()=>R(Ft,{});wt(()=>R(Kt,{}),document.getElementById("root"));
